<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>知遇论坛 | 与你知遇</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
                        url('https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-attachment: fixed;
            color: #333;
            min-height: 100vh;
            position: relative;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* 头部样式 */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            padding-left: 20px;
        }

        .logo h1 {
            font-size: 28px;
            background: linear-gradient(90deg, #4e54c8, #8f94fb);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .logo i {
            font-size: 32px;
            color: #4e54c8;
            margin-right: 10px;
        }

        .user-actions {
            display: flex;
            align-items: center;
            padding-right: 20px;
        }

        .user-actions a {
            margin-left: 15px;
            text-decoration: none;
            color: #4e54c8;
            font-weight: 600;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .user-actions a:hover {
            background-color: #4e54c8;
            color: white;
        }

        .user-info-display {
            display: flex;
            align-items: center;
            margin-right: 15px;
            color: #4e54c8;
            font-weight: 600;
            padding: 8px 15px;
            border-radius: 5px;
            background: rgba(78, 84, 200, 0.1);
        }

        .user-info-display i {
            margin-right: 8px;
            color: #4e54c8;
        }

        /* 主内容区样式 */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        .forum-container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .back-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            display: none;
        }

        .forum-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #4e54c8;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
            margin-right: 15px;
            position: relative;
            background-size: cover;
            background-position: center;
        }

        .v-badge {
            position: absolute;
            bottom: -3px;
            right: -3px;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #ff416c, #ff4b2b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: gold;
            font-weight: bold;
            font-size: 12px;
            border: 2px solid white;
        }

        .user-info {
            flex: 1;
        }

        .user-info h2 {
            font-size: 20px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .verified-badge {
            background: linear-gradient(90deg, #ff416c, #ff4b2b);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .join-btn {
            background: linear-gradient(90deg, #ff416c, #ff4b2b);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .join-btn.joined {
            background: linear-gradient(90deg, #11998e, #38ef7d);
            box-shadow: 0 0 15px rgba(17, 153, 142, 0.5);
        }

        .join-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 75, 43, 0.3);
        }

        .join-btn.joined:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(17, 153, 142, 0.3);
        }

        .join-count {
            color: #666;
            font-size: 14px;
            margin-left: 15px;
        }

        .join-count strong {
            color: #ff416c;
            font-weight: 700;
            transition: all 0.3s;
        }

        .join-count strong.highlight {
            color: #38ef7d;
            font-size: 16px;
            transform: scale(1.1);
        }

        .forum-intro {
            margin-bottom: 20px;
            color: #555;
            line-height: 1.6;
        }

        .stats-container {
            display: flex;
            justify-content: space-around;
            background: linear-gradient(90deg, #f5f7fa, #e4e7eb);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .stat-box {
            text-align: center;
        }

        .stat-box .number {
            font-size: 24px;
            font-weight: 700;
            color: #4e54c8;
        }

        .stat-box .label {
            font-size: 14px;
            color: #666;
        }

        .divider {
            height: 1px;
            background-color: #e0e0e0;
            margin: 25px 0;
        }

        .subforums-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .subforums-header h3 {
            font-size: 22px;
            color: #333;
        }

        .new-topic-btn {
            background: linear-gradient(90deg, #11998e, #38ef7d);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .new-topic-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(17, 153, 142, 0.3);
        }

        .subforums-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .subforum-card {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s;
            border: 1px solid #e9ecef;
            cursor: pointer;
            width: 200px;
            height: 122px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .subforum-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .subforum-card.active {
            border: 2px solid #4e54c8;
            box-shadow: 0 0 15px rgba(78, 84, 200, 0.2);
        }

        .subforum-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .subforum-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #4e54c8;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            margin-right: 10px;
        }

        .subforum-title {
            font-weight: 600;
            font-size: 16px;
        }

        .subforum-desc {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            line-height: 1.5;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .subforum-stats {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #888;
        }

        /* 帖子区域 */
        .topics-container {
            margin-top: 30px;
        }

        .topics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .topic-nav {
            display: flex;
            gap: 15px;
        }

        .topic-nav-btn {
            background: none;
            border: none;
            padding: 5px 10px;
            font-weight: 600;
            cursor: pointer;
            color: #666;
        }

        .topic-nav-btn.active {
            color: #4e54c8;
            border-bottom: 2px solid #4e54c8;
        }

        .search-box {
            display: flex;
            gap: 10px;
        }

        .search-box input {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            min-width: 250px;
        }

        .search-box button {
            background: linear-gradient(90deg, #4e54c8, #8f94fb);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
        }

        .topic-list {
            margin-top: 20px;
        }

        .topic-section {
            margin-bottom: 30px;
        }

        .topic-section h3 {
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .topic-section h3 i {
            color: #4e54c8;
        }

        .topic-item {
            display: flex;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: all 0.2s;
            position: relative;
        }

        .topic-item:hover {
            background: #f8f9fa;
        }

        .topic-content {
            flex: 1;
        }

        .topic-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .topic-title:hover {
            color: #4e54c8;
        }

        .topic-tag {
            background: #eef2ff;
            color: #4e54c8;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .topic-meta {
            display: flex;
            color: #888;
            font-size: 13px;
            gap: 15px;
        }

        .topic-user {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 150px;
        }

        .topic-user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #4e54c8;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
        }

        .expand-topics {
            text-align: center;
            margin: 15px 0;
        }

        .expand-btn {
            background: none;
            border: none;
            color: #4e54c8;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 15px;
        }

        .expand-btn:hover {
            text-decoration: underline;
        }

        /* 侧边栏样式 */
        .sidebar {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            height: fit-content;
            display: flex;
            flex-direction: column;
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .sidebar-section:last-child {
            margin-bottom: 0;
        }

        .sidebar-section h3 {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            color: #4e54c8;
            text-align: center;
        }

        .login-form {
            display: flex;
            flex-direction: column;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4e54c8;
        }

        .form-btn {
            background: linear-gradient(90deg, #4e54c8, #8f94fb);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .form-btn:hover {
            opacity: 0.9;
        }

        .register-link {
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
        }

        .register-link a {
            color: #4e54c8;
            text-decoration: none;
            font-weight: 500;
        }

        .register-link a:hover {
            text-decoration: underline;
        }

        .stats-box {
            background: linear-gradient(135deg, #f5f7fa, #e4e7eb);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 15px;
        }

        .stats-value {
            font-size: 32px;
            font-weight: 700;
            color: #4e54c8;
            margin: 10px 0;
        }

        .stats-label {
            font-size: 14px;
            color: #666;
        }

        .user-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            display: none;
        }

        .user-card-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 32px;
            margin: 0 auto 15px auto;
            position: relative;
            background-size: cover;
            background-position: center;
        }

        .user-card-name {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 5px;
            text-align: center;
        }

        .user-card-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            text-align: center;
        }

        .user-card-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            justify-content: center;
        }

        .user-card-stat {
            text-align: center;
        }

        .user-card-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #4e54c8;
        }

        .user-card-stat-label {
            font-size: 12px;
            color: #888;
        }

        .special-users {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .special-user {
            display: flex;
            align-items: center;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .special-user:hover {
            transform: translateX(5px);
            background-color: #eef2ff;
        }

        .special-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
            position: relative;
            flex-shrink: 0;
            cursor: pointer;
            background-size: cover;
            background-position: center;
        }

        .special-user-info {
            flex: 1;
            min-width: 0;
        }

        .special-user-name {
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .special-user-title {
            font-size: 12px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* 每周活跃用户榜样式 */
        .active-users {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .active-user-item {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .active-user-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .active-user-rank {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .rank-1 {
            background: #ff416c; /* 红色 */
        }

        .rank-2 {
            background: #ff9a00; /* 橙色 */
        }

        .rank-3 {
            background: #ffcc00; /* 黄色 */
        }

        .rank-4, .rank-5, .rank-6 {
            background: #a0a0a0; /* 灰色 */
        }

        .active-user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #4e54c8;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
            flex-shrink: 0;
            position: relative;
        }

        .active-user-info {
            flex: 1;
            min-width: 0;
        }

        .active-user-name {
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .active-user-stats {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: #888;
        }

        .active-user-stats span {
            display: flex;
            align-items: center;
        }

        .active-user-stats i {
            margin-right: 3px;
        }

        /* 模态框样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            top: 50%;
            transform: translateY(-50%);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: #4e54c8;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* 页脚样式 */
        footer {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }

        .footer-links a {
            margin: 0 10px;
            color: #4e54c8;
            text-decoration: none;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        /* 新增样式 */
        .new-topic-sidebar {
            text-align: center;
            margin-top: 15px;
            margin-bottom: 25px;
        }

        .profile-container {
            padding: 20px;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .profile-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }

        .profile-action-btn {
            background: linear-gradient(90deg, #4e54c8, #8f94fb);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            max-width: 250px;
        }

        .profile-action-btn.edit-btn {
            background: linear-gradient(90deg, #11998e, #38ef7d);
        }

        .profile-action-btn.manage-btn {
            background: linear-gradient(90deg, #ff416c, #ff4b2b);
        }

        .profile-stats {
            display: flex;
            gap: 20px;
            margin: 30px 0;
        }

        .profile-stat {
            flex: 1;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .profile-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #4e54c8;
            margin-bottom: 5px;
        }

        .profile-stat-label {
            font-size: 14px;
            color: #666;
        }

        .custom-alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            z-index: 2000;
            display: none;
            max-width: 90%;
            text-align: center;
            line-height: 1.6;
        }

        /* 用户管理相关样式 */
        .user-management-result {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .user-result-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .user-info-container {
            display: flex;
            align-items: center;
        }

        .user-actions-container {
            display: flex;
            gap: 10px;
        }

        .grant-vip-btn, .revoke-vip-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
        }

        .grant-vip-btn {
            background: #38ef7d;
            color: white;
        }

        .revoke-vip-btn {
            background: #ff416c;
            color: white;
        }

        /* 帖子管理控件 */
        .topic-admin-control {
            margin-top: 10px;
        }

        .topic-admin-select {
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
        }

        /* 用户内容区域 */
        .user-content-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .content-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            position: relative;
        }

        .delete-content-btn {
            position: absolute;
            right: 15px;
            top: 15px;
            background: #ff416c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
        }

        /* 头像上传区域 */
        .avatar-upload {
            position: relative;
            display: inline-block;
        }

        .avatar-upload input[type="file"] {
            display: none;
        }

        /* 富文本编辑器样式 */
        .editor-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .editor-toolbar button {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .editor-toolbar button:hover {
            background: #eef2ff;
        }

        .editor-content {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            overflow: auto;
            outline: none;
        }

        .editor-content:focus {
            border-color: #4e54c8;
        }

        .editor-content img, .editor-content video {
            max-width: 100%;
            display: block;
            margin: 10px 0;
        }

        /* 新增精华/置顶标识样式 */
        .featured-badge, .sticky-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border: 1px solid gold;
            border-radius: 3px;
            font-weight: bold;
            color: gold;
            background: transparent;
            animation: blink 1.5s infinite;
            margin-right: 5px;
        }

        .featured-badge::after {
            content: '精';
            font-size: 12px;
        }

        .sticky-badge::after {
            content: '顶';
            font-size: 12px;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.6; box-shadow: 0 0 8px gold; }
            100% { opacity: 1; }
        }

        /* 文件上传按钮样式 */
        .file-upload-btn {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-upload-btn input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .subforums-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .topic-user {
                display: none;
            }

            .topic-admin-control {
                position: relative;
                top: 0;
                right: 0;
                margin-top: 10px;
            }

            .profile-actions {
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 480px) {
            .subforums-grid {
                grid-template-columns: 1fr;
            }

            .user-actions {
                flex-direction: column;
                align-items: flex-end;
            }

            .user-actions a {
                margin: 5px 0;
            }

            .search-box input {
                min-width: auto;
                width: 150px;
            }

            .topics-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .search-box {
                width: 100%;
            }

            .search-box input {
                width: 100%;
            }
        }

        .no-topics {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }

        /* 修复背景问题 */
        .forum-container, .sidebar, footer {
            background-color: white;
        }

        .forum-intro, .stats-container, .topic-section, .topic-item {
            background-color: transparent;
        }

        .topic-section h3 {
            background-color: #f8f9fa;
        }

        /* 用户管理按钮样式 */
        .user-management-btn {
            background: linear-gradient(90deg, #ff9a00, #ffcc00);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }

        .user-management-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 154, 0, 0.3);
        }

        /* 用户列表样式 */
        .all-users-section {
            margin-top: 20px;
        }

        .all-users-section h3 {
            margin-bottom: 15px;
            color: #4e54c8;
            text-align: center;
        }

        .user-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        .user-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .user-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .user-avatar-small {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #4e54c8;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
            margin: 0 auto 10px auto;
            background-size: cover;
            background-position: center;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .user-id {
            font-size: 12px;
            color: #888;
        }

        /* 新增头像悬停效果 */
        .avatar-hover {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
            cursor: pointer;
        }

        .avatar-upload:hover .avatar-hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="custom-alert" id="custom-alert"></div>

    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-comments"></i>
                <h1>知遇社区</h1>
            </div>
            <div class="user-actions">
                <a href="#" id="login-link"></a>
                <a href="#" id="register-link"></a>
                <a href="#" id="profile-link">我的主页</a>
            </div>
        </header>

        <div class="main-content">
            <div class="forum-container">
                <button class="back-btn" id="back-btn">
                    <i class="fas fa-arrow-left"></i> 返回首页
                </button>

                <div class="forum-header">
                    <div class="user-avatar" id="main-avatar">
                        知遇
                        <div class="v-badge">V</div>
                    </div>
                    <div class="user-info">
                        <h2>知遇论坛官方账号</h2>
                        <p>欢迎来到我们的技术交流社区</p>
                    </div>
                    <button class="join-btn" id="join-btn">加入本论坛</button>
                    <div class="join-count">已加入 <strong>24,568</strong> 位用户</div>
                </div>

                <div class="forum-intro">
                    <p>这是一个专注于技术交流和学习的现代化论坛。在这里，您可以分享知识、提出问题、参与讨论，与来自世界各地的技术爱好者共同成长。</p>
                </div>

                <div class="stats-container">
                    <div class="stat-box">
                        <div class="number">128</div>
                        <div class="label">今日话题</div>
                    </div>
                    <div class="stat-box">
                        <div class="number">342</div>
                        <div class="label">昨日话题</div>
                    </div>
                    <div class="stat-box">
                        <div class="number">56,892</div>
                        <div class="label">全部话题</div>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="subforums-header">
                    <h3>群组子板块</h3>
                </div>

                <div class="subforums-grid">
                    <div class="subforum-card active" data-category="all">
                        <div class="subforum-header">
                            <div class="subforum-icon">
                                <i class="fas fa-home"></i>
                            </div>
                            <div class="subforum-title">全部板块</div>
                        </div>
                        <div class="subforum-desc">
                            查看所有话题和内容
                        </div>
                        <div class="subforum-stats">
                            <div>话题: 56,892</div>
                        </div>
                    </div>

                    <div class="subforum-card" data-category="official">
                        <div class="subforum-header">
                            <div class="subforum-icon">
                                <i class="fas fa-bullhorn"></i>
                            </div>
                            <div class="subforum-title">官方公告</div>
                        </div>
                        <div class="subforum-desc">
                            官方公告、近期活动、重要通知
                        </div>
                        <div class="subforum-stats">
                            <div>话题: 24</div>
                        </div>
                    </div>

                    <div class="subforum-card" data-category="daily">
                        <div class="subforum-header">
                            <div class="subforum-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="subforum-title">日常交流</div>
                        </div>
                        <div class="subforum-desc">
                            生活日常、兴趣爱好、非技术话题
                        </div>
                        <div class="subforum-stats">
                            <div>话题: 1,248</div>
                        </div>
                    </div>

                    <div class="subforum-card" data-category="tech">
                        <div class="subforum-header">
                            <div class="subforum-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            <div class="subforum-title">技术交流</div>
                        </div>
                        <div class="subforum-desc">
                            编程技术、开发经验、框架学习
                        </div>
                        <div class="subforum-stats">
                            <div>话题: 3,572</div>
                        </div>
                    </div>

                    <!-- 新增建议反馈子板块 -->
                    <div class="subforum-card" data-category="feedback">
                        <div class="subforum-header">
                            <div class="subforum-icon">
                                <i class="fas fa-comment-dots"></i>
                            </div>
                            <div class="subforum-title">建议反馈</div>
                        </div>
                        <div class="subforum-desc">
                            用户建议、功能反馈、问题报告
                        </div>
                        <div class="subforum-stats">
                            <div>话题: 48</div>
                        </div>
                    </div>
                </div>

                <div class="topics-container">
                    <div class="topics-header">
                        <div class="topic-nav">
                            <button class="topic-nav-btn active" data-tab="all">首页</button>
                            <button class="topic-nav-btn" data-tab="featured">精华话题</button>
                            <button class="topic-nav-btn" data-tab="sticky">置顶话题</button>
                        </div>
                        <div class="search-box">
                            <input type="text" id="search-input" placeholder="搜索帖子...">
                            <button id="search-btn"><i class="fas fa-search"></i> 查找</button>
                        </div>
                    </div>

                    <div class="topic-list" id="topic-list">
                        <!-- 动态生成话题列表 -->
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="sidebar-section" id="login-section">
                    <h3>用户登录</h3>
                    <form class="login-form" id="login-form">
                        <div class="form-group">
                            <label for="username">用户名</label>
                            <input type="text" id="username" placeholder="请输入用户名">
                        </div>
                        <div class="form-group">
                            <label for="password">密码</label>
                            <input type="password" id="password" placeholder="请输入密码">
                        </div>
                        <button type="submit" class="form-btn">登录</button>
                        <div class="register-link">
                            还没有账号？<a href="#" id="sidebar-register-link">立即注册</a>
                        </div>
                    </form>
                </div>

                <div class="user-card" id="user-card">
                    <div class="user-card-avatar" id="sidebar-avatar">
                        <div class="v-badge">V</div>
                    </div>
                    <div class="user-card-name" id="sidebar-name">系统管理员</div>
                    <div class="user-card-title" id="sidebar-title">官方认证大V用户</div>
                    <p id="sidebar-bio">论坛管理员，负责平台维护和用户管理</p>
                    <div class="user-card-stats">
                        <div class="user-card-stat">
                            <div class="user-card-stat-value">Lv.100</div>
                            <div class="user-card-stat-label">等级</div>
                        </div>
                        <div class="user-card-stat">
                            <div class="user-card-stat-value">24</div>
                            <div class="user-card-stat-label">帖子</div>
                        </div>
                        <div class="user-card-stat">
                            <div class="user-card-stat-value">150万</div>
                            <div class="user-card-stat-label">粉丝</div>
                        </div>
                    </div>
                </div>

                <div class="new-topic-sidebar">
                    <button class="new-topic-btn" id="new-topic-btn">
                        <i class="fas fa-plus"></i> 发表新话题
                    </button>
                </div>

                <div class="sidebar-section">
                    <h3>官方认证用户</h3>
                    <div class="special-users">
                        <div class="special-user" data-user="001">
                            <div class="special-user-avatar">
                                管
                                <div class="v-badge">V</div>
                            </div>
                            <div class="special-user-info">
                                <div class="special-user-name">系统管理员</div>
                                <div class="special-user-title">账号: 001 | 粉丝: 150万</div>
                            </div>
                        </div>
                        <div class="special-user" data-user="10000">
                            <div class="special-user-avatar">
                                技
                                <div class="v-badge">V</div>
                            </div>
                            <div class="special-user-info">
                                <div class="special-user-name">技术总监</div>
                                <div class="special-user-title">账号: 10000 | 粉丝: 10万</div>
                            </div>
                        </div>
                        <div class="special-user" data-user="10001">
                            <div class="special-user-avatar">
                                运
                                <div class="v-badge">V</div>
                            </div>
                            <div class="special-user-info">
                                <div class="special-user-name">运营经理</div>
                                <div class="special-user-title">账号: 10001 | 粉丝: 10万</div>
                            </div>
                        </div>
                        <!-- 新增社区运营账号 -->
                        <div class="special-user" data-user="10002">
                            <div class="special-user-avatar">
                                社
                                <div class="v-badge">V</div>
                            </div>
                            <div class="special-user-info">
                                <div class="special-user-name">社区运营</div>
                                <div class="special-user-title">账号: 10002 | 粉丝: 5万</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 新增每周用户活跃榜 -->
                <div class="sidebar-section">
                    <h3>每周用户活跃榜</h3>
                    <div class="active-users" id="active-users-list">
                        <!-- 动态生成活跃用户列表 -->
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <div class="footer-links">
                <a href="#">关于我们</a>
                <a href="#">使用条款</a>
                <a href="#">隐私政策</a>
                <a href="#">联系我们</a>
            </div>
            <p>&copy; 1995-2025 知遇论坛 技术交流社区 | 打造专业的技术讨论平台</p>
        </footer>
    </div>

    <!-- 模态框 -->
    <div class="modal" id="register-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>用户注册</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="register-form">
                    <div class="form-group">
                        <label for="reg-username">用户名</label>
                        <input type="text" id="reg-username" placeholder="至少6位字符">
                    </div>
                    <div class="form-group">
                        <label for="reg-password">密码</label>
                        <input type="password" id="reg-password" placeholder="至少8位字符">
                    </div>
                    <div class="form-group">
                        <label for="reg-email">邮箱</label>
                        <input type="email" id="reg-email" placeholder="请输入邮箱">
                    </div>
                    <div class="form-group" style="display: flex; gap: 10px;">
                        <input type="text" id="reg-code" style="flex: 1;" placeholder="验证码">
                        <button type="button" id="send-code-btn" style="background: #4e54c8; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">获取验证码</button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-register" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-weight: 600; cursor: pointer;">取消</button>
                <button type="submit" form="register-form" style="background: #4e54c8; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-weight: 600; cursor: pointer;">注册</button>
            </div>
        </div>
    </div>

    <div class="modal" id="new-topic-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>发表新话题</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="topic-form">
                    <div class="form-group" style="display: flex; gap: 10px;">
                        <div style="flex: 1;">
                            <label for="topic-category">选择子板块</label>
                            <select id="topic-category" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="">请选择板块</option>
                                <option value="official">官方公告</option>
                                <option value="daily">日常交流</option>
                                <option value="tech">技术交流</option>
                                <option value="feedback">建议反馈</option>
                            </select>
                        </div>
                        <div style="flex: 2;">
                            <label for="topic-title">标题</label>
                            <input type="text" id="topic-title" placeholder="标题 (2-30字)" style="width: 100%;">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>内容编辑</label>
                        <div class="editor-toolbar">
                            <button type="button" title="加粗" id="bold-btn"><i class="fas fa-bold"></i></button>
                            <button type="button" title="斜体" id="italic-btn"><i class="fas fa-italic"></i></button>
                            <button type="button" title="下划线" id="underline-btn"><i class="fas fa-underline"></i></button>
                            <button type="button" title="左对齐" id="align-left-btn"><i class="fas fa-align-left"></i></button>
                            <button type="button" title="居中" id="align-center-btn"><i class="fas fa-align-center"></i></button>
                            <button type="button" title="右对齐" id="align-right-btn"><i class="fas fa-align-right"></i></button>

                            <!-- 文件上传按钮 -->
                            <div class="file-upload-btn">
                                <button type="button" title="插入图片" id="insert-image-btn"><i class="fas fa-image"></i></button>
                                <input type="file" id="image-upload" accept="image/*">
                            </div>

                            <div class="file-upload-btn">
                                <button type="button" title="插入视频" id="insert-video-btn"><i class="fas fa-video"></i></button>
                                <input type="file" id="video-upload" accept="video/*">
                            </div>
                        </div>
                        <div class="editor-content" id="topic-content-editor" contenteditable="true"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-topic" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-weight: 600; cursor: pointer;">取消</button>
                <button type="submit" form="topic-form" style="background: #38ef7d; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-weight: 600; cursor: pointer;">发布</button>
            </div>
        </div>
    </div>

    <div class="modal" id="topic-detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="topic-detail-title">帖子详情</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="topic-meta" style="margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div class="topic-user-avatar" id="topic-author-avatar">A</div>
                        <div>
                            <div style="font-weight: 600;" id="topic-author-name">系统管理员</div>
                            <div style="font-size: 12px; color: #888;" id="topic-publish-time">2023-08-10 14:30</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; font-size: 13px; color: #888;">
                        <span>浏览: <span id="topic-views">1242</span></span>
                        <span>回复: <span id="topic-replies">56</span></span>
                    </div>

                    <!-- 帖子管理控件 -->
                    <div class="topic-admin-control" id="topic-admin-control" style="display: none;">
                        <select class="topic-admin-select" id="topic-admin-select">
                            <option value="">管理操作</option>
                            <option value="sticky">设为置顶</option>
                            <option value="unsticky">取消置顶</option>
                            <option value="featured">设为精华</option>
                            <option value="unfeatured">取消精华</option>
                            <option value="delete">删除帖子</option>
                        </select>
                    </div>
                </div>

                <div id="topic-detail-content" style="line-height: 1.6; margin-bottom: 30px;">
                    <p>论坛将于本周六（8月12日）凌晨2点至5点进行系统升级维护，届时论坛将无法访问。升级后我们将提供更稳定的服务和更多新功能，敬请期待！</p>
                    <p>升级内容包括：</p>
                    <ul style="margin: 10px 0 10px 20px;">
                        <li>服务器硬件升级</li>
                        <li>数据库优化</li>
                        <li>新增夜间模式</li>
                        <li>改进搜索功能</li>
                    </ul>
                    <p>对于维护期间给您带来的不便，我们深表歉意。如有任何问题，请联系客服。</p>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                    <h4 style="margin-bottom: 15px; color: #4e54c8;">评论 (3)</h4>
                    <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <div class="topic-user-avatar">T1</div>
                            <div>
                                <div style="font-weight: 600;">技术总监</div>
                                <div style="font-size: 12px; color: #888;">2023-08-10 15:42</div>
                            </div>
                        </div>
                        <div style="padding-left: 40px;">
                            感谢通知，期待新功能上线！
                        </div>
                    </div>
                    <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <div class="topic-user-avatar">U</div>
                            <div>
                                <div style="font-weight: 600;">用户体验师</div>
                                <div style="font-size: 12px; color: #888;">2023-08-10 16:15</div>
                            </div>
                        </div>
                        <div style="padding-left: 40px;">
                            终于要增加夜间模式了，太好了！
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <div class="topic-user-avatar">F</div>
                            <div>
                                <div style="font-weight: 600;">前端开发者</div>
                                <div style="font-size: 12px; color: #888;">2023-08-10 17:30</div>
                            </div>
                        </div>
                        <div style="padding-left: 40px;">
                            希望升级后搜索功能能更精准一些。
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <textarea id="comment-input" placeholder="写下您的评论..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 15px;"></textarea>
                <button id="submit-comment-btn" style="background: #4e54c8; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-weight: 600; cursor: pointer;">发表评论</button>
            </div>
        </div>
    </div>

    <!-- 编辑资料模态框 -->
    <div class="modal" id="edit-profile-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>编辑个人资料</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-profile-form">
                    <div class="form-group">
                        <label for="edit-username">账号</label>
                        <input type="text" id="edit-username" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label for="edit-display-name">用户昵称</label>
                        <input type="text" id="edit-display-name" placeholder="输入您的用户昵称">
                    </div>
                    <div class="form-group">
                        <label for="edit-bio">个人简介</label>
                        <textarea id="edit-bio" placeholder="输入您的个人简介" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; min-height: 100px;"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-edit-profile" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-weight: 600; cursor: pointer;">取消</button>
                <button id="save-profile" style="background: #4e54c8; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-weight: 600; cursor: pointer;">保存</button>
            </div>
        </div>
    </div>

    <!-- 用户管理模态框 -->
    <div class="modal" id="user-management-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>用户管理</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="search-user">搜索用户</label>
                    <input type="text" id="search-user" placeholder="输入用户名或ID">
                    <button id="search-user-btn" style="margin-top: 10px; background: #4e54c8; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">搜索</button>
                </div>

                <div class="user-management-result" id="user-management-result">
                    <!-- 搜索结果将在这里显示 -->
                </div>

                <div class="all-users-section">
                    <h3>所有注册用户</h3>
                    <div class="user-list" id="all-users-list">
                        <!-- 所有用户将在这里显示 -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="close-user-management" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-weight: 600; cursor: pointer;">关闭</button>
            </div>
        </div>
    </div>

    <script>
        // 模拟特殊账号数据
        const specialAccounts = {
            '001': {
                username: '001',
                password: '001',
                displayName: '系统管理员',
                avatar: '管',
                level: 100,
                followers: 1500000,
                isVerified: true,
                posts: 24,
                bio: '论坛管理员，负责平台维护和用户管理',
                joinDate: '2022-01-15',
                content: [
                    { id: 1, type: 'topic', title: '论坛维护通知：本周六凌晨2点至5点进行系统升级', content: '论坛维护详细内容...', date: '2023-08-10', category: 'official', isSticky: true, isFeatured: false, originalCategory: 'official' },
                    { id: 2, type: 'comment', content: '感谢通知，期待新功能上线！', topicId: 1, date: '2023-08-10' }
                ],
                avatarImage: null,
                activity: 95 // 活跃度分数
            },
            '10000': {
                username: '10000',
                password: '10000',
                displayName: '技术总监',
                avatar: '技',
                level: 100,
                followers: 100000,
                isVerified: true,
                posts: 56,
                bio: '技术专家，负责技术内容审核',
                joinDate: '2022-03-20',
                content: [
                    { id: 3, type: 'topic', title: 'JavaScript高级编程技巧与实践', content: 'JavaScript高级编程内容...', date: '2023-08-01', category: 'tech', isSticky: true, isFeatured: true, originalCategory: 'tech' },
                    { id: 4, type: 'comment', content: '这篇文章非常有用！', topicId: 3, date: '2023-08-02' }
                ],
                avatarImage: null,
                activity: 88
            },
            // 新增社区运营账号
            '10002': {
                username: '10002',
                password: '10002',
                displayName: '社区运营',
                avatar: '社',
                level: 90,
                followers: 50000,
                isVerified: true,
                posts: 38,
                bio: '社区运营专员，负责用户沟通和活动策划',
                joinDate: '2022-05-15',
                content: [
                    { id: 7, type: 'topic', title: '社区活动：开发者挑战赛即将开始', content: '活动详情...', date: '2023-08-12', category: 'official', isSticky: false, isFeatured: false, originalCategory: 'official' },
                    { id: 8, type: 'comment', content: '欢迎大家积极参与！', topicId: 7, date: '2023-08-12' }
                ],
                avatarImage: null,
                activity: 82
            }
        };

        // 模拟普通用户数据
        const users = {
            '110643': {
                username: '110643',
                password: '110643',
                displayName: '前端开发者',
                avatar: 'F',
                level: 25,
                followers: 1200,
                isVerified: false,
                posts: 15,
                bio: '专注于React和Vue开发',
                joinDate: '2023-01-10',
                content: [
                    { id: 5, type: 'topic', title: 'React 18新特性解析及使用心得', content: 'React 18使用心得...', date: '2023-08-14', category: 'tech', isSticky: false, isFeatured: false, originalCategory: 'tech' },
                    { id: 6, type: 'comment', content: '感谢分享，学到了很多！', topicId: 5, date: '2023-08-15' }
                ],
                avatarImage: null,
                activity: 78
            },
            '120956': {
                username: '120956',
                password: '120956',
                displayName: '后端工程师',
                avatar: 'B',
                level: 30,
                followers: 2500,
                isVerified: false,
                posts: 22,
                bio: 'Java和Spring框架专家',
                joinDate: '2023-02-15',
                content: [],
                avatarImage: null,
                activity: 85
            },
            '310654': {
                username: '310456',
                password: '310456',
                displayName: 'UI设计师',
                avatar: 'U',
                level: 20,
                followers: 1800,
                isVerified: false,
                posts: 18,
                bio: '专注于用户体验设计',
                joinDate: '2023-03-20',
                content: [],
                avatarImage: null,
                activity: 80
            }
        };

        // 当前登录用户
        let currentUser = null;
        let joinedForum = false;
        let expandedTopics = false;
        let currentCategory = 'all'; // 当前选中的板块
        let currentTab = 'all'; // 当前选中的标签
        let currentTopicId = null; // 当前查看的帖子ID
        let topics = []; // 所有话题数据
        let allUsers = []; // 所有用户列表

        // 模态框控制
        const modals = {
            register: document.getElementById('register-modal'),
            topic: document.getElementById('new-topic-modal'),
            topicDetail: document.getElementById('topic-detail-modal'),
            editProfile: document.getElementById('edit-profile-modal'),
            userManagement: document.getElementById('user-management-modal')
        };

        // 初始化话题数据
        function initTopics() {
            topics = [
                { id: 1, title: '论坛维护通知：本周六凌晨2点至5点进行系统升级', author: '系统管理员', date: '2023-08-10', views: 1242, replies: 56, category: 'official', originalCategory: 'official', tags: ['官方公告'], isSticky: true, isFeatured: true, content: '<p>论坛将于本周六（8月12日）凌晨2点至5点进行系统升级维护，届时论坛将无法访问。升级后我们将提供更稳定的服务和更多新功能，敬请期待！</p><p>升级内容包括：</p><ul><li>服务器硬件升级</li><li>数据库优化</li><li>新增夜间模式</li><li>改进搜索功能</li></ul><p>对于维护期间给您带来的不便，我们深表歉意。如有任何问题，请联系客服。</p>' },
                { id: 2, title: '新版论坛上线，新增多项功能', author: '技术总监', date: '2023-08-05', views: 3421, replies: 124, category: 'official', originalCategory: 'official', tags: ['官方公告'], isSticky: true, isFeatured: false, content: '<p>我们很高兴地宣布，知遇论坛社区全新版本正式上线！本次更新带来了多项改进和新功能：</p><p>主要更新：</p><ul><li>全新响应式设计，适配各种设备</li><li>优化个人主页，新增粉丝和等级系统</li><li>帖子分类功能，更易查找相关内容</li><li>性能优化，页面加载速度提升50%</li></ul><p>感谢各位用户一直以来的支持，我们将继续努力提供更好的社区体验！</p>' },
                { id: 3, title: 'JavaScript高级编程技巧与实践', author: '技术总监', date: '2023-08-01', views: 8921, replies: 342, category: 'tech', originalCategory: 'tech', tags: ['技术交流'], isSticky: true, isFeatured: true, content: '<p>在这篇文章中，我将分享一些JavaScript高级编程技巧，帮助您写出更高效、更优雅的代码。</p><p><strong>1. 闭包的应用</strong></p><p>闭包是JavaScript中一个非常重要的概念，它允许函数访问其词法作用域之外的变量：</p><pre>function createCounter() { let count = 0; return function() { count++; return count; }; } const counter = createCounter(); console.log(counter()); // 1 console.log(counter()); // 2</pre>' },
                { id: 4, title: '社区规则更新通知', author: '社区运营', date: '2023-07-28', views: 842, replies: 42, category: 'official', originalCategory: 'official', tags: ['官方公告'], isSticky: false, isFeatured: false, content: '<p>我们更新了社区规则，请所有用户仔细阅读并遵守。</p>' },
                { id: 5, title: 'Python数据科学最佳实践', author: '技术总监', date: '2023-07-25', views: 5210, replies: 210, category: 'tech', originalCategory: 'tech', tags: ['技术交流'], isSticky: false, isFeatured: true, content: '<p>Python在数据科学领域的应用越来越广泛，本文将分享一些最佳实践。</p>' },
                { id: 6, title: 'React 18新特性解析及使用心得', author: '前端开发者', date: '2023-08-14', views: 342, replies: 24, category: 'tech', originalCategory: 'tech', tags: ['技术交流'], isSticky: false, isFeatured: false, content: '<p>React 18带来了许多令人兴奋的新特性，本文分享我的使用心得。</p>' },
                { id: 7, title: '大家平时都用什么开发工具？', author: '开发者小王', date: '2023-08-14', views: 124, replies: 32, category: 'daily', originalCategory: 'daily', tags: ['日常交流'], isSticky: false, isFeatured: false, content: '<p>想了解大家都使用哪些开发工具来提高工作效率？</p>' },
                { id: 8, title: '建议增加夜间模式功能', author: '用户体验师', date: '2023-08-13', views: 214, replies: 18, category: 'feedback', originalCategory: 'feedback', tags: ['建议反馈'], isSticky: false, isFeatured: false, content: '<p>建议论坛增加夜间模式功能，保护用户视力。</p>' },
                // 已删除开发者挑战赛帖子（id:9）
            ];
        }

        // 初始化用户数据
        function initUsers() {
            // 合并特殊账号和普通用户
            allUsers = [
                ...Object.values(specialAccounts),
                ...Object.values(users)
            ];
        }

        // 自定义提示
        function showCustomAlert(message) {
            const alert = document.getElementById('custom-alert');
            alert.textContent = message;
            alert.style.display = 'block';

            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }

        // 关闭所有模态框
        function closeAllModals() {
            Object.values(modals).forEach(modal => modal.style.display = 'none');
        }

        // 显示模态框
        function showModal(modalId) {
            closeAllModals();
            document.getElementById(modalId).style.display = 'flex';

            // 如果是用户管理模态框，初始化用户列表
            if (modalId === 'user-management-modal') {
                renderAllUsers();
            }
        }

        // 注册关闭按钮事件
        document.querySelectorAll('.close-modal').forEach(button => {
            button.addEventListener('click', closeAllModals);
        });

        // 注册链接事件
        document.getElementById('register-link').addEventListener('click', function(e) {
            e.preventDefault();
            showModal('register-modal');
        });

        document.getElementById('sidebar-register-link').addEventListener('click', function(e) {
            e.preventDefault();
            showModal('register-modal');
        });

        // 获取验证码按钮事件
        document.getElementById('send-code-btn').addEventListener('click', function() {
            const email = document.getElementById('reg-email').value;
            if (!validateEmail(email)) {
                showCustomAlert("提示：\n请输入有效的邮箱地址");
                return;
            }

            showCustomAlert(`提示：\n验证码已发送至: ${email}\n（验证码五分钟内有效）`);
        });

        // 注册表单提交
        document.getElementById('register-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            const email = document.getElementById('reg-email').value;
            const code = document.getElementById('reg-code').value;

            // 检查特殊账号
            if (specialAccounts[username] || users[username]) {
                showCustomAlert("提示：\n该用户名已被注册");
                return;
            }

            // 验证用户名和密码长度（特殊账号除外）
            if (username.length < 6) {
                showCustomAlert("提示：\n用户名至少需要6位字符");
                return;
            }

            if (password.length < 8) {
                showCustomAlert("提示：\n密码至少需要8位字符");
                return;
            }

            if (!validateEmail(email)) {
                showCustomAlert("提示：\n请输入有效的邮箱地址");
                return;
            }

            if (code !== '021001') {
                showCustomAlert("提示：\n验证码错误\n当前并未开放注册\n如需注册请联系管理员");
                return;
            }

            // 注册成功
            users[username] = {
                username: username,
                password: password,
                displayName: username,
                avatar: username.charAt(0).toUpperCase(),
                level: 1,
                followers: 0,
                isVerified: false,
                joinDate: new Date().toLocaleDateString(),
                posts: 0,
                bio: '',
                content: [],
                avatarImage: null,
                activity: Math.floor(Math.random() * 100) // 随机活跃度
            };

            // 更新用户列表
            initUsers();

            showCustomAlert(`提示：\n注册成功！欢迎 ${username}`);
            closeAllModals();
        });

        // 登录表单提交
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // 检查特殊账号
            if (specialAccounts[username] && specialAccounts[username].password === password) {
                currentUser = specialAccounts[username];
                updateUIAfterLogin();
                return;
            }

            // 检查普通用户
            if (users[username] && users[username].password === password) {
                currentUser = users[username];
                updateUIAfterLogin();
                return;
            }

            // 普通账号模拟登录
            currentUser = {
                username: username,
                password: password,
                displayName: username,
                avatar: username.charAt(0).toUpperCase(),
                level: 1,
                followers: 0,
                isVerified: false,
                joinDate: new Date().toLocaleDateString(),
                posts: 0,
                bio: '',
                content: [],
                avatarImage: null,
                activity: Math.floor(Math.random() * 100) // 随机活跃度
            };

            updateUIAfterLogin();
        });

        // 更新登录后的UI
        function updateUIAfterLogin() {
            // 更新头部
            document.querySelector('.user-actions').innerHTML = `
                <div class="user-info-display">
                    <i class="fas fa-user"></i>
                    ${currentUser.displayName || currentUser.username}
                </div>
                <a href="#" id="profile-link">我的主页</a>
                <a href="#" id="logout-link">退出</a>
            `;

            // 更新侧边栏
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('user-card').style.display = 'block';

            updateAvatar(currentUser.avatarImage);

            document.getElementById('sidebar-name').textContent = currentUser.displayName || currentUser.username;
            document.getElementById('sidebar-title').textContent = currentUser.isVerified ? '官方认证大V用户' : '普通用户';
            document.getElementById('sidebar-bio').textContent = currentUser.bio || '暂无简介';

            // 添加事件
            document.getElementById('logout-link').addEventListener('click', function(e) {
                e.preventDefault();
                currentUser = null;
                location.reload();
            });

            document.getElementById('profile-link').addEventListener('click', function(e) {
                e.preventDefault();
                showProfilePage();
            });
        }

        // 更新头像
        function updateAvatar(avatarImage) {
            const avatarPreview = document.getElementById('sidebar-avatar');

            if (avatarImage) {
                avatarPreview.style.backgroundImage = `url(${avatarImage})`;
                avatarPreview.textContent = '';
            } else {
                avatarPreview.style.backgroundImage = 'none';
                avatarPreview.textContent = currentUser.avatar;
            }
        }

        // 显示个人主页
        function showProfilePage() {
            // 移除现有的个人主页（如果存在）
            const existingProfile = document.querySelector('.profile-container');
            if (existingProfile) existingProfile.remove();

            document.querySelector('.back-btn').style.display = 'block';
            document.querySelector('.forum-header').style.display = 'none';
            document.querySelector('.forum-intro').style.display = 'none';
            document.querySelector('.stats-container').style.display = 'none';
            document.querySelector('.divider').style.display = 'none';
            document.querySelector('.subforums-header').style.display = 'none';
            document.querySelector('.subforums-grid').style.display = 'none';
            document.querySelector('.topics-container').style.display = 'none';

            const profileHTML = `
                <div class="profile-container">
                    <div class="profile-header">
                        <h2 style="color: #4e54c8;">个人主页</h2>
                    </div>

                    <div style="display: flex; margin-bottom: 20px;">
                        <div style="position: relative; margin-right: 20px;">
                            <div class="avatar-upload">
                                <div class="user-card-avatar" id="avatar-preview" style="width: 100px; height: 100px; ${currentUser.avatarImage ? `background-image: url(${currentUser.avatarImage});` : ''}">
                                    ${currentUser.avatarImage ? '' : currentUser.avatar}
                                    ${currentUser.isVerified ? '<div class="v-badge">V</div>' : ''}
                                    <!-- 添加头像悬停效果 -->
                                    <div class="avatar-hover">
                                        <i class="fas fa-camera"></i>
                                        <div>更换头像</div>
                                    </div>
                                </div>
                                <input type="file" id="avatar-input" accept="image/*">
                            </div>
                        </div>

                        <div style="flex: 1;">
                            <h3 style="font-size: 24px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px;">
                                ${currentUser.displayName || currentUser.username}
                                ${currentUser.isVerified ? '<span class="verified-badge">官方认证大V用户</span>' : ''}
                            </h3>
                            <p style="color: #666; margin-bottom: 10px;">账号: ${currentUser.username}</p>
                            <p style="color: #666; margin-bottom: 10px;">注册时间: ${currentUser.joinDate}</p>
                            <p style="color: #666; margin-bottom: 15px;">等级: Lv.${currentUser.level}</p>
                        </div>
                    </div>

                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="profile-stat-value">${currentUser.posts || 0}</div>
                            <div class="profile-stat-label">发布帖子</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value">${currentUser.followers.toLocaleString()}</div>
                            <div class="profile-stat-label">粉丝</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value">${currentUser.level}</div>
                            <div class="profile-stat-label">等级</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px; color: #4e54c8;">个人简介</h3>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; min-height: 100px;" id="bio-content">
                            ${currentUser.bio || '暂无简介'}
                        </div>
                    </div>

                    <!-- 我发表的内容区域 -->
                    <div class="user-content-section">
                        <h3 style="margin-bottom: 15px; color: #4e54c8;">我发表的内容</h3>
                        <div id="user-content-list">
                            ${currentUser.content && currentUser.content.length > 0
                                ? currentUser.content.map(item => `
                                    <div class="content-item">
                                        ${item.type === 'topic'
                                            ? `<div><strong>话题:</strong> ${item.title}</div>`
                                            : `<div><strong>评论:</strong> ${item.content}</div>`}
                                        <div style="color: #888; font-size: 13px; margin-top: 5px;">${item.date}</div>
                                        <button class="delete-content-btn" data-id="${item.id}">删除</button>
                                    </div>`)
                                .join('')
                                : '<p>暂无发表内容</p>'}
                        </div>
                    </div>

                    <div class="profile-actions">
                        <button class="profile-action-btn edit-btn" id="edit-profile-btn">
                            <i class="fas fa-edit"></i> 编辑资料
                        </button>
                        ${currentUser.username === '001' ? `
                        <button class="profile-action-btn manage-btn" id="user-management-btn">
                            <i class="fas fa-users-cog"></i> 用户管理
                        </button>
                        ` : ''}
                    </div>
                </div>
            `;

            document.querySelector('.forum-container').insertAdjacentHTML('beforeend', profileHTML);

            // 头像上传功能
            const avatarInput = document.getElementById('avatar-input');
            const avatarPreview = document.getElementById('avatar-preview');

            if (avatarInput && avatarPreview) {
                // 添加点击事件到悬停层
                const avatarHover = avatarPreview.querySelector('.avatar-hover');
                avatarHover.addEventListener('click', function() {
                    avatarInput.click();
                });

                avatarInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            avatarPreview.style.backgroundImage = `url(${e.target.result})`;
                            avatarPreview.textContent = '';
                            currentUser.avatarImage = e.target.result;

                            // 更新其他地方的avatar
                            updateAvatar(e.target.result);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // 添加事件
            document.getElementById('edit-profile-btn').addEventListener('click', function() {
                document.getElementById('edit-username').value = currentUser.username;
                document.getElementById('edit-display-name').value = currentUser.displayName;
                document.getElementById('edit-bio').value = currentUser.bio || '';

                showModal('edit-profile-modal');
            });

            // 用户管理按钮
            if (document.getElementById('user-management-btn')) {
                document.getElementById('user-management-btn').addEventListener('click', function() {
                    showModal('user-management-modal');
                });
            }

            // 删除内容按钮事件
            document.querySelectorAll('.delete-content-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const contentId = this.getAttribute('data-id');
                    deleteUserContent(contentId);
                });
            });
        }

        // 删除用户内容
        function deleteUserContent(contentId) {
            if (confirm("确定要删除这条内容吗？")) {
                currentUser.content = currentUser.content.filter(item => item.id != contentId);
                document.querySelector('.profile-container').remove();
                showProfilePage();
                showCustomAlert("内容已删除");
            }
        }

        // 返回首页按钮
        document.getElementById('back-btn').addEventListener('click', function() {
            document.querySelector('.back-btn').style.display = 'none';
            document.querySelector('.forum-header').style.display = 'flex';
            document.querySelector('.forum-intro').style.display = 'block';
            document.querySelector('.stats-container').style.display = 'flex';
            document.querySelector('.divider').style.display = 'block';
            document.querySelector('.subforums-header').style.display = 'flex';
            document.querySelector('.subforums-grid').style.display = 'grid';
            document.querySelector('.topics-container').style.display = 'block';

            // 移除个人主页内容
            const profileContainer = document.querySelector('.profile-container');
            if (profileContainer) {
                profileContainer.remove();
            }

            // 重置当前板块
            currentCategory = 'all';
            document.querySelectorAll('.subforum-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector('.subforum-card[data-category="all"]').classList.add('active');

            // 重新渲染话题
            renderTopics();
        });

        // 加入论坛按钮事件
        document.getElementById('join-btn').addEventListener('click', function() {
            const joinCount = document.querySelector('.join-count strong');
            let count = parseInt(joinCount.textContent.replace(/,/g, ''));

            if (joinedForum) {
                // 取消加入
                count--;
                joinCount.textContent = count.toLocaleString();
                this.textContent = '加入本社区';
                this.classList.remove('joined');
                this.style.background = 'linear-gradient(90deg, #ff416c, #ff4b2b)';
                joinedForum = false;
                showCustomAlert("提示：\n您已退出知遇社区！");

                // 添加动画效果
                joinCount.classList.remove('highlight');
            } else {
                // 加入论坛
                count++;
                joinCount.textContent = count.toLocaleString();
                this.textContent = '已加入';
                this.classList.add('joined');
                this.style.background = '#38ef7d';
                joinedForum = true;
                showCustomAlert("提示：\n欢迎加入知遇社区！");

                // 添加动画效果
                joinCount.classList.add('highlight');
                setTimeout(() => joinCount.classList.remove('highlight'), 1000);
            }
        });

        // 特殊用户点击事件 - 已移除提示功能
        document.querySelectorAll('.special-user').forEach(user => {
            user.addEventListener('click', function() {
                // 点击特殊用户不再显示提示
            });
        });

        // 用户头像点击事件 - 已移除提示功能
        document.querySelectorAll('.topic-user-avatar, .special-user-avatar').forEach(avatar => {
            avatar.addEventListener('click', function(e) {
                e.stopPropagation();
                // 点击用户头像不再显示提示
            });
        });

        // 更新子版块话题数量
        function updateSubforumStats(category) {
            // 更新"全部板块"的数量
            const allCard = document.querySelector('.subforum-card[data-category="all"]');
            if (allCard) {
                const allStats = allCard.querySelector('.subforum-stats');
                const allCount = parseInt(allStats.textContent.match(/话题: (\d+)/)[1]);
                allStats.innerHTML = `话题: ${allCount + 1}`;
            }

            // 更新特定子版块的数量
            if (category && category !== 'all') {
                const categoryCard = document.querySelector(`.subforum-card[data-category="${category}"]`);
                if (categoryCard) {
                    const categoryStats = categoryCard.querySelector('.subforum-stats');
                    const categoryCount = parseInt(categoryStats.textContent.match(/话题: (\d+)/)[1]);
                    categoryStats.innerHTML = `话题: ${categoryCount + 1}`;
                }
            }
        }

        // 帖子表单提交
        document.getElementById('topic-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const title = document.getElementById('topic-title').value;
            const category = document.getElementById('topic-category').value;
            const content = document.getElementById('topic-content-editor').innerHTML;

            if (!category) {
                showCustomAlert("提示：\n请选择子板块");
                return;
            }

            if (title.length < 2 || title.length > 30) {
                showCustomAlert("提示：\n标题长度需在2-30字之间");
                return;
            }

            if (!content) {
                showCustomAlert("提示：\n请输入帖子内容");
                return;
            }

            // 普通用户不能发布到官方公告板块
            if (category === 'official' && !(currentUser.username in specialAccounts)) {
                showCustomAlert("提示：\n普通用户不能发布到官方公告板块");
                return;
            }

            // 创建新话题
            const newTopic = {
                id: Date.now(),
                title: title,
                author: currentUser.displayName || currentUser.username,
                date: new Date().toLocaleDateString(),
                views: 0,
                replies: 0,
                category: category,
                originalCategory: category,
                tags: [category === 'official' ? '官方公告' :
                       category === 'daily' ? '日常交流' :
                       category === 'tech' ? '技术交流' : '建议反馈'],
                isSticky: false,
                isFeatured: false,
                content: content
            };

            // 添加到话题列表
            topics.unshift(newTopic);

            // 保存用户发表的内容
            const newUserTopic = {
                id: newTopic.id,
                type: 'topic',
                title: title,
                content: content,
                date: new Date().toLocaleDateString()
            };

            if (!currentUser.content) currentUser.content = [];
            currentUser.content.push(newUserTopic);

            // 更新帖子数量
            currentUser.posts = (currentUser.posts || 0) + 1;

            // 更新子版块话题数量
            updateSubforumStats(category);

            showCustomAlert("提示：\n帖子发布成功！");
            closeAllModals();

            // 重新渲染话题
            renderTopics();
        });

        // 验证邮箱格式
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // 取消按钮事件
        document.getElementById('cancel-register').addEventListener('click', closeAllModals);
        document.getElementById('cancel-topic').addEventListener('click', closeAllModals);
        document.getElementById('cancel-edit-profile').addEventListener('click', closeAllModals);
        document.getElementById('close-user-management').addEventListener('click', closeAllModals);

        // 渲染话题列表
        function renderTopics() {
            const topicList = document.getElementById('topic-list');
            topicList.innerHTML = '';

            // 过滤话题
            let filteredTopics = topics.filter(topic => {
                // 按板块过滤
                if (currentCategory !== 'all' && topic.category !== currentCategory) {
                    return false;
                }

                // 按标签过滤
                if (currentTab === 'featured' && !topic.isFeatured) {
                    return false;
                }

                if (currentTab === 'sticky' && !topic.isSticky) {
                    return false;
                }

                return true;
            });

            // 置顶话题（包含精华贴）
            const stickyTopics = filteredTopics.filter(topic => topic.isSticky);
            // 精华话题（所有精华贴）
            const featuredTopics = filteredTopics.filter(topic => topic.isFeatured);
            // 普通话题（既不是置顶也不是精华）
            const normalTopics = filteredTopics.filter(topic => !topic.isSticky && !topic.isFeatured);

            // 如果没有话题
            if (filteredTopics.length === 0) {
                topicList.innerHTML = `
                    <div class="no-topics">
                        <i class="fas fa-inbox" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
                        <p>当前没有话题，成为第一个发表话题的人吧！</p>
                    </div>
                `;
                return;
            }

            // 首页（all标签）下，不单独显示精华贴区块
            if (currentTab === 'all') {
                // 渲染置顶话题
                if (stickyTopics.length > 0) {
                    const stickyHTML = `
                        <div class="topic-section">
                            <h3><i class="fas fa-thumbtack"></i> 置顶贴</h3>
                            ${stickyTopics.map(topic => `
                                <div class="topic-item">
                                    <div class="topic-content">
                                        <div class="topic-title" data-id="${topic.id}">
                                            ${topic.isSticky ? '<span class="sticky-badge"></span>' : ''}
                                            ${topic.isFeatured ? '<span class="featured-badge"></span>' : ''}
                                            <span class="topic-tag">[${topic.isSticky ? '置顶帖子' : topic.isFeatured ? '精华帖子' : topic.tags[0]}]</span>
                                            <span>${topic.title}</span>
                                        </div>
                                        <div class="topic-meta">
                                            <span>${topic.author}</span>
                                            <span>${topic.date}</span>
                                            <span>浏览: ${topic.views}</span>
                                            <span>回复: ${topic.replies}</span>
                                        </div>
                                    </div>
                                    <div class="topic-user">
                                        <div class="topic-user-avatar">${topic.author.charAt(0)}</div>
                                        <span>${topic.author}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;

                    topicList.innerHTML += stickyHTML;
                }

                // 渲染普通话题
                if (normalTopics.length > 0) {
                    const normalHTML = `
                        <div class="topic-section">
                            <h3><i class="fas fa-comments"></i> 普通话题</h3>
                            ${normalTopics.map(topic => `
                                <div class="topic-item">
                                    <div class="topic-content">
                                        <div class="topic-title" data-id="${topic.id}">
                                            ${topic.isSticky ? '<span class="sticky-badge"></span>' : ''}
                                            ${topic.isFeatured ? '<span class="featured-badge"></span>' : ''}
                                            <span class="topic-tag">[${topic.isSticky ? '置顶帖子' : topic.isFeatured ? '精华帖子' : topic.tags[0]}]</span>
                                            <span>${topic.title}</span>
                                        </div>
                                        <div class="topic-meta">
                                            <span>${topic.author}</span>
                                            <span>${topic.date}</span>
                                            <span>浏览: ${topic.views}</span>
                                            <span>回复: ${topic.replies}</span>
                                        </div>
                                    </div>
                                    <div class="topic-user">
                                        <div class="topic-user-avatar">${topic.author.charAt(0)}</div>
                                        <span>${topic.author}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;

                    topicList.innerHTML += normalHTML;
                }
            }
            // 精华话题标签页
            else if (currentTab === 'featured') {
                if (featuredTopics.length > 0) {
                    const featuredHTML = `
                        <div class="topic-section">
                            <h3><i class="fas fa-star"></i> 精华贴</h3>
                            ${featuredTopics.map(topic => `
                                <div class="topic-item">
                                    <div class="topic-content">
                                        <div class="topic-title" data-id="${topic.id}">
                                            ${topic.isSticky ? '<span class="sticky-badge"></span>' : ''}
                                            ${topic.isFeatured ? '<span class="featured-badge"></span>' : ''}
                                            <span class="topic-tag">[${topic.isSticky ? '置顶帖子' : topic.isFeatured ? '精华帖子' : topic.tags[0]}]</span>
                                            <span>${topic.title}</span>
                                        </div>
                                        <div class="topic-meta">
                                            <span>${topic.author}</span>
                                            <span>${topic.date}</span>
                                            <span>浏览: ${topic.views}</span>
                                            <span>回复: ${topic.replies}</span>
                                        </div>
                                    </div>
                                    <div class="topic-user">
                                        <div class="topic-user-avatar">${topic.author.charAt(0)}</div>
                                        <span>${topic.author}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;

                    topicList.innerHTML += featuredHTML;
                } else {
                    topicList.innerHTML = `
                        <div class="no-topics">
                            <i class="fas fa-star" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
                            <p>当前没有精华话题</p>
                        </div>
                    `;
                }
            }
            // 置顶话题标签页
            else if (currentTab === 'sticky') {
                if (stickyTopics.length > 0) {
                    const stickyHTML = `
                        <div class="topic-section">
                            <h3><i class="fas fa-thumbtack"></i> 置顶贴</h3>
                            ${stickyTopics.map(topic => `
                                <div class="topic-item">
                                    <div class="topic-content">
                                        <div class="topic-title" data-id="${topic.id}">
                                            ${topic.isSticky ? '<span class="sticky-badge"></span>' : ''}
                                            ${topic.isFeatured ? '<span class="featured-badge"></span>' : ''}
                                            <span class="topic-tag">[${topic.isSticky ? '置顶帖子' : topic.isFeatured ? '精华帖子' : topic.tags[0]}]</span>
                                            <span>${topic.title}</span>
                                        </div>
                                        <div class="topic-meta">
                                            <span>${topic.author}</span>
                                            <span>${topic.date}</span>
                                            <span>浏览: ${topic.views}</span>
                                            <span>回复: ${topic.replies}</span>
                                        </div>
                                    </div>
                                    <div class="topic-user">
                                        <div class="topic-user-avatar">${topic.author.charAt(0)}</div>
                                        <span>${topic.author}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;

                    topicList.innerHTML += stickyHTML;
                } else {
                    topicList.innerHTML = `
                        <div class="no-topics">
                            <i class="fas fa-thumbtack" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
                            <p>当前没有置顶话题</p>
                        </div>
                    `;
                }
            }

            // 添加话题点击事件
            document.querySelectorAll('.topic-title').forEach(title => {
                title.addEventListener('click', function() {
                    const topicId = parseInt(this.getAttribute('data-id'));
                    showTopicDetail(topicId);
                });
            });
        }

        // 显示话题详情
        function showTopicDetail(topicId) {
            const topic = topics.find(t => t.id === topicId);
            if (!topic) return;

            showModal('topic-detail-modal');

            // 更新话题详情
            document.getElementById('topic-detail-title').textContent = topic.title;
            document.getElementById('topic-detail-content').innerHTML = topic.content;
            document.getElementById('topic-author-name').textContent = topic.author;
            document.getElementById('topic-publish-time').textContent = topic.date;
            document.getElementById('topic-views').textContent = topic.views;
            document.getElementById('topic-replies').textContent = topic.replies;
            document.getElementById('topic-author-avatar').textContent = topic.author.charAt(0);

            // 更新管理下拉菜单
            const adminSelect = document.getElementById('topic-admin-select');
            adminSelect.innerHTML = `
                <option value="">管理操作</option>
                ${topic.isSticky ?
                    '<option value="unsticky">取消置顶</option>' :
                    '<option value="sticky">设为置顶</option>'}
                ${topic.isFeatured ?
                    '<option value="unfeatured">取消精华</option>' :
                    '<option value="featured">设为精华</option>'}
                <option value="delete">删除帖子</option>
            `;

            // 如果是管理员，显示管理控件
            if (currentUser && currentUser.username === '001') {
                document.getElementById('topic-admin-control').style.display = 'block';
            } else {
                document.getElementById('topic-admin-control').style.display = 'none';
            }

            // 保存当前话题ID
            currentTopicId = topicId;
        }

        // 切换标签
        document.querySelectorAll('.topic-nav-btn').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.topic-nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                currentTab = this.getAttribute('data-tab');
                renderTopics();
            });
        });

        // 板块选择
        document.querySelectorAll('.subforum-card').forEach(card => {
            card.addEventListener('click', function() {
                currentCategory = this.getAttribute('data-category');

                // 更新UI
                document.querySelectorAll('.subforum-card').forEach(c => {
                    c.classList.remove('active');
                });
                this.classList.add('active');

                renderTopics();
            });
        });

        // 搜索功能
        document.getElementById('search-btn').addEventListener('click', function() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            if (searchTerm) {
                const filteredTopics = topics.filter(topic =>
                    topic.title.toLowerCase().includes(searchTerm) ||
                    topic.content.toLowerCase().includes(searchTerm)
                );

                if (filteredTopics.length === 0) {
                    showCustomAlert(`提示：\n没有找到包含"${searchTerm}"的帖子`);
                    return;
                }

                // 临时显示搜索结果
                const topicList = document.getElementById('topic-list');
                topicList.innerHTML = `
                    <div class="topic-section">
                        <h3><i class="fas fa-search"></i> 搜索结果</h3>
                        ${filteredTopics.map(topic => `
                            <div class="topic-item">
                                <div class="topic-content">
                                    <div class="topic-title" data-id="${topic.id}">
                                        <span class="topic-tag">[${topic.isSticky ? '置顶帖子' : topic.isFeatured ? '精华帖子' : topic.tags[0]}]</span>
                                        <span>${topic.title}</span>
                                    </div>
                                    <div class="topic-meta">
                                        <span>${topic.author}</span>
                                        <span>${topic.date}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;

                // 添加话题点击事件
                document.querySelectorAll('.topic-title').forEach(title => {
                    title.addEventListener('click', function() {
                        const topicId = parseInt(this.getAttribute('data-id'));
                        showTopicDetail(topicId);
                    });
                });
            } else {
                showCustomAlert("提示：\n请输入搜索关键词");
            }
        });

        // 发表新话题按钮事件
        document.getElementById('new-topic-btn').addEventListener('click', function() {
            if (!currentUser) {
                showCustomAlert("提示：\n请先登录后再发表新话题");
                return;
            }
            // 清空编辑器
            document.getElementById('topic-content-editor').innerHTML = '';
            showModal('new-topic-modal');
        });

        // 帖子管理功能
        document.getElementById('topic-admin-select')?.addEventListener('change', function() {
            const action = this.value;
            const topic = topics.find(t => t.id === currentTopicId);
            if (!topic) return;

            switch(action) {
                case 'sticky':
                    topic.isSticky = true;
                    topic.category = '置顶帖子';
                    showCustomAlert("帖子已设为置顶");
                    renderTopics();
                    break;
                case 'unsticky':
                    topic.isSticky = false;
                    topic.category = topic.originalCategory;
                    showCustomAlert("帖子已取消置顶");
                    renderTopics();
                    break;
                case 'featured':
                    topic.isFeatured = true;
                    topic.category = '精华帖子';
                    showCustomAlert("帖子已设为精华");
                    renderTopics();
                    break;
                case 'unfeatured':
                    topic.isFeatured = false;
                    topic.category = topic.originalCategory;
                    showCustomAlert("帖子已取消精华");
                    renderTopics();
                    break;
                case 'delete':
                    if (confirm("确定要删除这条帖子吗？")) {
                        topics = topics.filter(t => t.id !== currentTopicId);
                        showCustomAlert("帖子已删除");
                        closeAllModals();
                        renderTopics();
                    }
                    break;
            }
            this.value = "";
        });

        // 保存编辑资料
        document.getElementById('save-profile')?.addEventListener('click', function() {
            const displayName = document.getElementById('edit-display-name').value;
            const bio = document.getElementById('edit-bio').value;
            const oldDisplayName = currentUser.displayName;

            if (!displayName) {
                showCustomAlert("提示：\n用户昵称不能为空");
                return;
            }

            // 更新当前用户的显示名称和个人简介
            currentUser.displayName = displayName;
            currentUser.bio = bio;

            // 更新侧边栏显示名称和个人简介
            document.getElementById('sidebar-name').textContent = displayName;
            document.getElementById('sidebar-bio').textContent = bio || '暂无简介';

            // 更新头部显示名称
            document.querySelector('.user-info-display').textContent = displayName;

            // 更新已发布的帖子作者名称
            topics.forEach(topic => {
                if (topic.author === oldDisplayName) {
                    topic.author = displayName;
                }
            });

            // 更新UI
            document.querySelector('.profile-container').remove();
            showProfilePage();
            closeAllModals();
            showCustomAlert("提示：\n资料更新成功！");
        });

        // 文件上传功能
        document.getElementById('image-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // 插入图片到编辑器
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '100%';
                    document.getElementById('topic-content-editor').appendChild(img);
                };
                reader.readAsDataURL(file);
            }
            // 重置input，允许再次选择同一文件
            this.value = '';
        });

        document.getElementById('video-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // 插入视频到编辑器
                    const video = document.createElement('video');
                    video.src = e.target.result;
                    video.controls = true;
                    video.style.maxWidth = '100%';
                    document.getElementById('topic-content-editor').appendChild(video);
                };
                reader.readAsDataURL(file);
            }
            this.value = '';
        });

        // 富文本编辑器功能
        const editor = document.getElementById('topic-content-editor');

        // 加粗
        document.getElementById('bold-btn').addEventListener('click', function() {
            document.execCommand('bold', false, null);
            editor.focus();
        });

        // 斜体
        document.getElementById('italic-btn').addEventListener('click', function() {
            document.execCommand('italic', false, null);
            editor.focus();
        });

        // 下划线
        document.getElementById('underline-btn').addEventListener('click', function() {
            document.execCommand('underline', false, null);
            editor.focus();
        });

        // 左对齐
        document.getElementById('align-left-btn').addEventListener('click', function() {
            document.execCommand('justifyLeft', false, null);
            editor.focus();
        });

        // 居中
        document.getElementById('align-center-btn').addEventListener('click', function() {
            document.execCommand('justifyCenter', false, null);
            editor.focus();
        });

        // 右对齐
        document.getElementById('align-right-btn').addEventListener('click', function() {
            document.execCommand('justifyRight', false, null);
            editor.focus();
        });

        // 用户管理功能
        document.getElementById('search-user-btn')?.addEventListener('click', function() {
            const searchTerm = document.getElementById('search-user').value.toLowerCase();
            const resultContainer = document.getElementById('user-management-result');
            resultContainer.innerHTML = '';

            if (!searchTerm) {
                resultContainer.innerHTML = '<p>请输入搜索关键词</p>';
                return;
            }

            // 搜索用户
            const results = allUsers.filter(user =>
                user.username.toLowerCase().includes(searchTerm) ||
                (user.displayName && user.displayName.toLowerCase().includes(searchTerm))
            );

            if (results.length === 0) {
                resultContainer.innerHTML = '<p>没有找到相关用户</p>';
                return;
            }

            results.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-result-item';
                userItem.innerHTML = `
                    <div class="user-info-container">
                        <div class="topic-user-avatar" style="margin-right: 10px;">${user.avatar}</div>
                        <div>
                            <div style="font-weight: 600;">${user.displayName || user.username}</div>
                            <div style="font-size: 12px; color: #888;">ID: ${user.username} | 状态: ${user.isVerified ? 'VIP用户' : '普通用户'}</div>
                        </div>
                    </div>
                    <div class="user-actions-container">
                        ${user.isVerified
                            ? `<button class="revoke-vip-btn" data-user="${user.username}">撤销大V</button>`
                            : `<button class="grant-vip-btn" data-user="${user.username}">授予大V</button>`}
                    </div>
                `;
                resultContainer.appendChild(userItem);
            });

            // 添加事件
            document.querySelectorAll('.grant-vip-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-user');
                    grantVIP(username);
                });
            });

            document.querySelectorAll('.revoke-vip-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-user');
                    revokeVIP(username);
                });
            });

            resultContainer.style.display = 'block';
        });

        // 授予VIP
        function grantVIP(username) {
            const user = allUsers.find(u => u.username === username);
            if (user) {
                user.isVerified = true;
                showCustomAlert(`已授予 ${user.displayName || user.username} VIP身份`);
                renderAllUsers();
                document.getElementById('user-management-result').innerHTML = '';
            }
        }

        // 撤销VIP
        function revokeVIP(username) {
            const user = allUsers.find(u => u.username === username);
            if (user && user.username !== '001') { // 不能撤销系统管理员的VIP
                user.isVerified = false;
                showCustomAlert(`已撤销 ${user.displayName || user.username} VIP身份`);
                renderAllUsers();
                document.getElementById('user-management-result').innerHTML = '';
            } else if (user.username === '001') {
                showCustomAlert("提示：\n不能撤销系统管理员的VIP身份");
            }
        }

        // 渲染所有用户
        function renderAllUsers() {
            const userList = document.getElementById('all-users-list');
            userList.innerHTML = '';

            allUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                    <div class="user-avatar-small" style="${user.avatarImage ? `background-image: url(${user.avatarImage})` : ''}">
                        ${user.avatarImage ? '' : user.avatar}
                        ${user.isVerified ? '<div class="v-badge" style="width: 15px; height: 15px; font-size: 8px;">V</div>' : ''}
                    </div>
                    <div class="user-name">${user.displayName || user.username}</div>
                    <div class="user-id">ID: ${user.username}</div>
                `;
                userList.appendChild(userItem);
            });
        }

        // 渲染活跃用户排行榜
        function renderActiveUsers() {
            const activeUsersList = document.getElementById('active-users-list');
            if (!activeUsersList) return;

            // 按活跃度排序（降序）
            const sortedUsers = [...allUsers].sort((a, b) => (b.activity || 0) - (a.activity || 0)).slice(0, 6);

            activeUsersList.innerHTML = '';

            sortedUsers.forEach((user, index) => {
                const rank = index + 1;

                const userItem = document.createElement('div');
                userItem.className = 'active-user-item';
                userItem.innerHTML = `
                    <div class="active-user-rank rank-${rank}">${rank}</div>
                    <div class="active-user-avatar">${user.avatar}</div>
                    <div class="active-user-info">
                        <div class="active-user-name">${user.displayName || user.username}</div>
                        <div class="active-user-stats">
                            <span><i class="fas fa-comment"></i> ${user.posts || 0}</span>
                            <span><i class="fas fa-fire"></i> ${user.activity || 0}</span>
                        </div>
                    </div>
                `;

                activeUsersList.appendChild(userItem);
            });
        }

        // 初始化
        function initForum() {
            initTopics();
            initUsers();
            renderTopics();
            renderActiveUsers(); // 渲染活跃用户排行榜

            // 默认选中"全部板块"
            document.querySelector('.subforum-card[data-category="all"]').classList.add('active');
        }

        // 页面加载完成后初始化论坛
        window.addEventListener('DOMContentLoaded', initForum);
    </script>
</body>
</html>
