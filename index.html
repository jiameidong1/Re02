<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>知遇论坛|相遇知己 缘分你我</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #1e88e5;
            --secondary-color: #42a5f5;
            --light-color: #e3f2fd;
            --dark-color: #0d47a1;
            --text-color: #333;
            --white: #fff;
            --gray: #f5f5f5;
            --border-color: #e0e0e0;
            --gold: #ffd700;
            --red: #f44336;
            --success-color: #4caf50;
            --tag-color: #e1f5fe;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: var(--light-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* 头部样式 */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .auth-buttons {
            display: flex;
            align-items: center;
        }

        .auth-buttons button {
            background-color: var(--white);
            color: var(--primary-color);
            border: none;
            padding: 8px 15px;
            margin-left: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .auth-buttons button:hover {
            background-color: var(--light-color);
        }

        .logout-btn {
            background-color: var(--red) !important;
            color: var(--white) !important;
            margin-left: 10px;
        }

        .logout-btn:hover {
            background-color: #d32f2f !important;
        }

        /* 主内容区 */
        .main-content {
            display: flex;
            margin-top: 20px;
        }

        /* 侧边栏 */
        .sidebar {
            width: 250px;
            margin-right: 20px;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            padding: 15px;
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
        }

        .user-card {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            transition: background-color 0.3s;
            position: relative;
        }

        .user-card:hover {
            background-color: var(--gray);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            position: relative;
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .v-badge {
            display: inline-block;
            background-color: var(--red);
            color: var(--gold);
            font-weight: bold;
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 2px;
            margin-left: 5px;
            vertical-align: middle;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: bold;
            font-size: 14px;
        }

        .user-desc {
            font-size: 12px;
            color: #777;
        }

        .follow-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .view-all {
            text-align: right;
            font-size: 12px;
            color: var(--primary-color);
            cursor: pointer;
        }

        /* 帖子列表 */
        .content-area {
            flex: 1;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            padding: 20px;
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .post-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .create-post-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .post-list {
            margin-top: 20px;
        }

        .post-item {
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
        }

        .post-item:last-child {
            border-bottom: none;
        }

        .post-author {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .post-author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            cursor: pointer;
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .post-author-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .post-author-info {
            flex: 1;
        }

        .post-author-name {
            font-weight: bold;
            cursor: pointer;
            display: inline-block;
        }

        .post-author-v {
            display: inline-block;
            background-color: var(--red);
            color: var(--gold);
            font-weight: bold;
            font-size: 10px;
            padding: 1px 3px;
            border-radius: 2px;
            margin-left: 5px;
            vertical-align: middle;
        }

        .post-author-level {
            font-size: 12px;
            color: #777;
        }

        .post-content {
            margin: 10px 0;
        }

        .post-title-link {
            font-size: 18px;
            font-weight: bold;
            color: var(--text-color);
            text-decoration: none;
            display: block;
            margin-bottom: 10px;
        }

        .post-excerpt {
            color: #555;
            margin-bottom: 10px;
            max-height: 80px;
            overflow: hidden;
            position: relative;
        }

        .post-excerpt img {
            max-width: 100%;
            max-height: 60px;
            margin: 5px 0;
        }

        .post-meta {
            display: flex;
            font-size: 12px;
            color: #777;
        }

        .post-meta-item {
            margin-right: 15px;
            display: flex;
            align-items: center;
        }

        .post-meta-item i {
            margin-right: 3px;
        }

        /* 帖子详情样式 */
        .post-detail {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-top: 20px;
        }

        .post-detail-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .post-detail-content {
            line-height: 1.8;
            font-size: 16px;
        }

        .post-detail-content img {
            max-width: 100%;
            height: auto;
            margin: 10px 0;
            border-radius: 8px;
        }

        .back-to-list {
            display: inline-block;
            margin-top: 20px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
        }

        /* 标签样式 */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }

        .tag {
            background-color: var(--tag-color);
            color: var(--primary-color);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .tag-remove {
            cursor: pointer;
            font-size: 12px;
            padding: 2px;
        }

        .tag-remove:hover {
            color: var(--red);
        }

        .tag-input-container {
            position: relative;
            margin: 10px 0;
        }

        .tag-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
        }

        .tag-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .tag-hint {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            color: #999;
            font-size: 12px;
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--white);
            width: 600px;
            max-width: 90%;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 15px 20px;
            background-color: var(--primary-color);
            color: var(--white);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--white);
            font-size: 20px;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* 登录表单特殊样式 */
        .login-form-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .login-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .login-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .login-form {
            width: 100%;
            max-width: 400px;
        }

        .login-title {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 24px;
        }

        .login-input-group {
            position: relative;
            margin-bottom: 20px;
        }

        .login-input-group i {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
        }

        .login-input {
            width: 100%;
            padding: 10px 10px 10px 35px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .login-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .remember-me {
            display: flex;
            align-items: center;
        }

        .remember-me input {
            margin-right: 5px;
        }

        .forgot-password {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 14px;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        .login-btn:hover {
            background-color: var(--dark-color);
        }

        .login-footer {
            text-align: center;
            margin-top: 20px;
            color: #777;
        }

        .login-footer a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .editor-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
            padding: 5px;
            background-color: var(--gray);
            border-radius: 4px;
        }

        .tool-btn {
            padding: 5px 10px;
            background-color: var(--white);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }

        .tool-btn:hover {
            background-color: var(--light-color);
        }

        .editor-content {
            min-height: 200px;
            border: 1px solid var(--border-color);
            padding: 10px;
            border-radius: 4px;
            outline: none;
        }

        .editor-content:focus {
            border-color: var(--primary-color);
        }

        .modal-footer {
            padding: 15px 20px;
            background-color: var(--gray);
            display: flex;
            justify-content: flex-end;
        }

        .btn {
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
        }

        .btn-secondary {
            background-color: var(--white);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        /* 个人主页样式 */
        .profile-header {
            display: flex;
            padding: 20px;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-right: 20px;
            position: relative;
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .profile-avatar .avatar-upload-icon {
            position: absolute;
            bottom: 0;
            right: 0;
            background: rgba(0,0,0,0.6);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
            display: inline-block;
        }

        .profile-v {
            display: inline-block;
            background-color: var(--red);
            color: var(--gold);
            font-weight: bold;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 5px;
            vertical-align: middle;
        }

        .profile-official {
            color: var(--red);
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-level {
            font-size: 14px;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .profile-account {
            font-size: 14px;
            color: #777;
            margin-bottom: 5px;
        }

        .profile-join-date {
            font-size: 14px;
            color: #777;
            margin-bottom: 10px;
        }

        .profile-stats {
            display: flex;
            margin-bottom: 15px;
        }

        .stat-item {
            margin-right: 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 18px;
            font-weight: bold;
        }

        .stat-label {
            font-size: 12px;
            color: #777;
        }

        .profile-bio {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .profile-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .edit-profile-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
        }

        .change-password-btn {
            background-color: var(--white);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .admin-btn {
            background-color: var(--red);
            color: var(--white);
            border: none;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                margin-right: 0;
                margin-bottom: 20px;
            }

            .profile-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .profile-avatar {
                margin-right: 0;
                margin-bottom: 15px;
            }

            .profile-stats {
                justify-content: center;
            }
        }

        /* 消息弹窗样式 */
        #messageModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 300;
            justify-content: center;
            align-items: center;
        }

        .message-content {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            max-width: 300px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .message-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 18px;
        }

        .message-text {
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .message-ok {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        /* 用户管理样式 */
        .user-management {
            max-height: 500px;
            overflow-y: auto;
        }

        .user-management-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.2s;
        }

        .user-management-item:hover {
            background-color: #f9f9f9;
        }

        .user-management-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
        }

        .user-management-info {
            flex: 1;
            min-width: 0;
        }

        .user-management-info div:first-child {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .user-management-actions {
            display: flex;
            gap: 10px;
        }

        /* 编辑资料样式 */
        .edit-profile-form textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            min-height: 100px;
            resize: vertical;
        }

        /* 头像上传预览 */
        .avatar-preview-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .avatar-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 10px;
            border: 2px solid var(--border-color);
        }
    </style>
</head>
<body>
    <!-- 头部 -->
    <header>
        <div class="container header-container">
            <div class="logo">知遇论坛 | 知无止境，遇有知音</div>
            <div class="auth-buttons">
                <button id="registerBtn">注册</button>
                <button id="loginBtn">登录</button>
                <button id="logoutBtn" class="logout-btn" style="display: none;">退出登录</button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <div class="container main-content">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">热门用户</div>
                <div class="user-card" data-userid="001">
                    <div class="user-avatar">
                        <img src="https://ui-avatars.com/api/?name=管理员&background=1e88e5&color=fff" alt="用户头像">
                    </div>
                    <div class="user-info">
                        <div class="user-name">管理员 <span class="v-badge">V</span></div>
                        <div class="user-desc">论坛管理员</div>
                    </div>
                    <button class="follow-btn">关注</button>
                </div>
                <div class="user-card" data-userid="10000">
                    <div class="user-avatar">
                        <img src="https://ui-avatars.com/api/?name=技术总监&background=1e88e5&color=fff" alt="用户头像">
                    </div>
                    <div class="user-info">
                        <div class="user-name">技术总监 <span class="v-badge">V</span></div>
                        <div class="user-desc">平台技术负责人</div>
                    </div>
                    <button class="follow-btn">关注</button>
                </div>
                <div class="user-card" data-userid="10001">
                    <div class="user-avatar">
                        <img src="https://ui-avatars.com/api/?name=产品经理&background=1e88e5&color=fff" alt="用户头像">
                    </div>
                    <div class="user-info">
                        <div class="user-name">产品经理 <span class="v-badge">V</span></div>
                        <div class="user-desc">产品设计与规划</div>
                    </div>
                    <button class="follow-btn">关注</button>
                </div>
                <div class="user-card" data-userid="10002">
                    <div class="user-avatar">
                        <img src="https://ui-avatars.com/api/?name=社区运营&background=1e88e5&color=fff" alt="用户头像">
                    </div>
                    <div class="user-info">
                        <div class="user-name">社区运营 <span class="v-badge">V</span></div>
                        <div class="user-desc">社区内容运营和用户关系维护</div>
                    </div>
                    <button class="follow-btn">关注</button>
                </div>
                <div class="view-all">查看全部</div>
            </div>
        </aside>

        <!-- 内容区 -->
        <main class="content-area" id="mainContentArea">
            <div class="post-header">
                <h1 class="post-title">最新帖子</h1>
                <button class="create-post-btn" id="createPostBtn">发布帖子</button>
            </div>

            <div class="post-list" id="postList">
                <!-- 帖子将通过JavaScript动态加载 -->
            </div>
        </main>
    </div>

    <!-- 注册模态框 -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">用户注册</div>
                <button class="close-btn" id="closeRegisterModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerUsername">账号</label>
                        <input type="text" id="registerUsername" class="form-control" placeholder="请输入6位以上账号">
                        <small class="form-text">账号不得少于6位</small>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">密码</label>
                        <input type="password" id="registerPassword" class="form-control" placeholder="请输入8位以上密码">
                        <small class="form-text">密码不得少于8位</small>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">确认密码</label>
                        <input type="password" id="confirmPassword" class="form-control" placeholder="请再次输入密码">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelRegister">取消</button>
                <button class="btn btn-primary" id="submitRegister">注册</button>
            </div>
        </div>
    </div>

    <!-- 登录模态框 -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">用户登录</div>
                <button class="close-btn" id="closeLoginModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="login-form-container">
                    <div class="login-avatar">
                        <img src="https://ui-avatars.com/api/?name=用户&background=1e88e5&color=fff" alt="用户头像" id="loginAvatarImg">
                    </div>
                    <form id="loginForm" class="login-form">
                        <h2 class="login-title">欢迎回来</h2>
                        <div class="login-input-group">
                            <i class="fas fa-user"></i>
                            <input type="text" id="loginUsername" class="login-input" placeholder="请输入您的账号">
                        </div>
                        <div class="login-input-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="loginPassword" class="login-input" placeholder="请输入您的密码">
                        </div>
                        <div class="login-actions">
                            <div class="remember-me">
                                <input type="checkbox" id="rememberMe">
                                <label for="rememberMe">记住我</label>
                            </div>
                            <a href="#" class="forgot-password">忘记密码?</a>
                        </div>
                        <button type="button" class="login-btn" id="submitLogin">登录</button>
                        <div class="login-footer">
                            还没有账号? <a href="#" id="goToRegister">立即注册</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 发布帖子模态框 -->
    <div class="modal" id="postModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">发布新帖子</div>
                <button class="close-btn" id="closePostModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="postForm">
                    <div class="form-group">
                        <label for="postTitle">帖子标题</label>
                        <input type="text" id="postTitle" class="form-control" placeholder="请输入帖子标题">
                    </div>

                    <!-- 标签功能区域 -->
                    <div class="form-group">
                        <label for="tagInput">标签</label>
                        <div class="tag-input-container">
                            <input type="text" id="tagInput" class="tag-input" placeholder="输入标签，按回车添加 (例: #公告)">
                            <span class="tag-hint">按回车添加</span>
                        </div>
                        <div class="tags-container" id="tagsContainer">
                            <!-- 标签将通过JavaScript动态添加 -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label>内容</label>
                        <div class="editor-toolbar">
                            <button type="button" class="tool-btn" data-command="fontName" data-value="Microsoft YaHei" title="微软雅黑"><i class="fas fa-font"></i></button>
                            <button type="button" class="tool-btn" data-command="fontName" data-value="SimSun" title="宋体"><i class="fas fa-font"></i></button>
                            <button type="button" class="tool-btn" data-command="fontName" data-value="NSimSun" title="新宋体"><i class="fas fa-font"></i></button>
                            <button type="button" class="tool-btn" data-command="fontName" data-value="FangSong" title="仿宋"><i class="fas fa-font"></i></button>
                            <button type="button" class="tool-btn" data-command="bold" title="加粗"><i class="fas fa-bold"></i></button>
                            <button type="button" class="tool-btn" id="insertImageBtn" title="插入图片"><i class="fas fa-image"></i></button>
                            <input type="file" id="imageUpload" style="display: none;" accept="image/*">
                            <button type="button" class="tool-btn" data-command="justifyLeft" title="左对齐"><i class="fas fa-align-left"></i></button>
                            <button type="button" class="tool-btn" data-command="justifyCenter" title="居中"><i class="fas fa-align-center"></i></button>
                            <button type="button" class="tool-btn" data-command="justifyRight" title="右对齐"><i class="fas fa-align-right"></i></button>
                            <button type="button" class="tool-btn" data-command="justifyFull" title="两端对齐"><i class="fas fa-align-justify"></i></button>
                        </div>
                        <div id="postContent" class="editor-content" contenteditable="true"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPost">取消</button>
                <button class="btn btn-primary" id="submitPost">发布</button>
            </div>
        </div>
    </div>

    <!-- 个人主页模态框 -->
    <div class="modal" id="profileModal">
        <div class="modal-content" style="width: 800px;">
            <div class="modal-header">
                <div class="modal-title">个人主页</div>
                <button class="close-btn" id="closeProfileModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatarContainer">
                        <img src="https://ui-avatars.com/api/?name=用户&background=1e88e5&color=fff" alt="用户头像" id="profileAvatarImg">
                        <div class="avatar-upload-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        <input type="file" id="avatarUpload" style="display: none;" accept="image/*">
                    </div>
                    <div class="profile-info">
                        <div>
                            <span class="profile-name" id="profileName">用户名</span>
                            <span class="profile-v" id="profileV">V</span>
                        </div>
                        <div class="profile-official" id="profileOfficial">官方认证大V用户</div>
                        <div class="profile-level" id="profileLevel">等级: Lv.1</div>
                        <div class="profile-account" id="profileAccount">账号: </div>
                        <div class="profile-join-date" id="profileJoinDate">注册时间: </div>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-number" id="postCount">0</div>
                                <div class="stat-label">发布帖子</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="followerCount">0</div>
                                <div class="stat-label">粉丝</div>
                            </div>
                        </div>
                        <div class="profile-bio" id="profileBio">这个人很懒，什么都没有留下...</div>
                        <div class="profile-actions">
                            <button class="action-btn edit-profile-btn" id="editProfileBtn">编辑资料</button>
                            <button class="action-btn change-password-btn" id="changePasswordBtn">修改密码</button>
                            <button class="action-btn admin-btn" id="adminBtn" style="display: none;">用户管理</button>
                        </div>
                    </div>
                </div>

                <div class="content-area">
                    <h2 class="post-title">我的帖子</h2>
                    <div class="post-list" id="userPostList">
                        <!-- 用户帖子将通过JavaScript动态加载 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑资料模态框 -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">编辑个人资料</div>
                <button class="close-btn" id="closeEditProfileModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="edit-profile-form">
                    <div class="form-group">
                        <label for="editBio">个人简介</label>
                        <textarea id="editBio" placeholder="介绍一下你自己..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditProfile">取消</button>
                <button class="btn btn-primary" id="saveProfile">保存</button>
            </div>
        </div>
    </div>

    <!-- 修改密码模态框 -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">修改密码</div>
                <button class="close-btn" id="closeChangePasswordModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="oldPassword">旧密码</label>
                    <input type="password" id="oldPassword" class="form-control" placeholder="请输入旧密码">
                </div>
                <div class="form-group">
                    <label for="newPassword">新密码</label>
                    <input type="password" id="newPassword" class="form-control" placeholder="请输入新密码">
                </div>
                <div class="form-group">
                    <label for="confirmNewPassword">确认新密码</label>
                    <input type="password" id="confirmNewPassword" class="form-control" placeholder="请再次输入新密码">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelChangePassword">取消</button>
                <button class="btn btn-primary" id="savePassword">保存</button>
            </div>
        </div>
    </div>

    <!-- 用户管理模态框 -->
    <div class="modal" id="adminModal">
        <div class="modal-content" style="width: 800px;">
            <div class="modal-header">
                <div class="modal-title">用户管理</div>
                <button class="close-btn" id="closeAdminModal">&times;</button>
            </div>
            <div class="modal-body user-management">
                <div class="user-management-item">
                    <div class="user-management-avatar">
                        <img src="https://ui-avatars.com/api/?name=管理员&background=1e88e5&color=fff" alt="管理员">
                    </div>
                    <div class="user-management-info">
                        <div>管理员 (ID: 001)</div>
                        <div class="user-desc">论坛管理员</div>
                    </div>
                    <div class="user-management-actions">
                        <button class="btn btn-secondary">编辑</button>
                        <button class="btn btn-secondary">重置密码</button>
                    </div>
                </div>
                <div class="user-management-item">
                    <div class="user-management-avatar">
                        <img src="https://ui-avatars.com/api/?name=技术总监&background=1e88e5&color=fff" alt="技术总监">
                    </div>
                    <div class="user-management-info">
                        <div>技术总监 (ID: 10000)</div>
                        <div class="user-desc">平台技术负责人</div>
                    </div>
                    <div class="user-management-actions">
                        <button class="btn btn-secondary">编辑</button>
                        <button class="btn btn-secondary">重置密码</button>
                    </div>
                </div>
                <div class="user-management-item">
                    <div class="user-management-avatar">
                        <img src="https://ui-avatars.com/api/?name=产品经理&background=1e88e5&color=fff" alt="产品经理">
                    </div>
                    <div class="user-management-info">
                        <div>产品经理 (ID: 10001)</div>
                        <div class="user-desc">产品设计与规划</div>
                    </div>
                    <div class="user-management-actions">
                        <button class="btn btn-secondary">编辑</button>
                        <button class="btn btn-secondary">重置密码</button>
                    </div>
                </div>
                <div class="user-management-item">
                    <div class="user-management-avatar">
                        <img src="https://ui-avatars.com/api/?name=社区运营&background=1e88e5&color=fff" alt="社区运营">
                    </div>
                    <div class="user-management-info">
                        <div>社区运营 (ID: 10002)</div>
                        <div class="user-desc">社区内容运营和用户关系维护</div>
                    </div>
                    <div class="user-management-actions">
                        <button class="btn btn-secondary">编辑</button>
                        <button class="btn btn-secondary">重置密码</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeAdmin">关闭</button>
            </div>
        </div>
    </div>

    <!-- 消息弹窗 -->
    <div id="messageModal">
        <div class="message-content">
            <div class="message-title">提示</div>
            <div class="message-text" id="messageText"></div>
            <button class="message-ok" id="messageOk">确定</button>
        </div>
    </div>

    <script>
        // 全局变量
        let currentUser = null;
        let users = [
            { id: '001', username: '管理员', password: '001', level: 100, isV: true, followers: 1500000, joinDate: '2020-01-01', bio: '论坛管理员，负责平台运营和管理工作。', avatar: 'https://ui-avatars.com/api/?name=管理员&background=1e88e5&color=fff' },
            { id: '10000', username: '技术总监', password: '10000', level: 100, isV: true, followers: 100000, joinDate: '2020-01-02', bio: '平台技术负责人，负责技术架构和开发工作。', avatar: 'https://ui-avatars.com/api/?name=技术总监&background=1e88e5&color=fff' },
            { id: '10001', username: '产品经理', password: '10001', level: 100, isV: true, followers: 100000, joinDate: '2020-01-03', bio: '产品设计与规划，用户体验优化。', avatar: 'https://ui-avatars.com/api/?name=产品经理&background=1e88e5&color=fff' },
            { id: '10002', username: '社区运营', password: '10002', level: 100, isV: true, followers: 100000, joinDate: '2020-01-04', bio: '社区内容运营和用户关系维护。', avatar: 'https://ui-avatars.com/api/?name=社区运营&background=1e88e5&color=fff' }
        ];

        let posts = [
            {
                id: 1,
                authorId: '001',
                title: '论坛使用规则公告',
                content: '<p>欢迎来到知遇论坛！为了维护良好的社区环境，请遵守以下规则：</p><ol><li>禁止发布违法信息</li><li>禁止人身攻击</li><li>保持文明交流</li></ol>',
                date: '2023-05-01',
                likes: 125,
                comments: 32,
                fullContent: '<h1>论坛使用规则公告</h1><p>欢迎来到知遇论坛！为了维护良好的社区环境，请遵守以下规则：</p><ol><li>禁止发布违法信息</li><li>禁止人身攻击</li><li>保持文明交流</li></ol>',
                tags: ['公告', '规则']
            },
            {
                id: 2,
                authorId: '10000',
                title: '新功能上线通知',
                content: '<p>我们很高兴地宣布，论坛新增了以下功能：</p><ul><li>帖子编辑器支持多种格式</li><li>新增用户等级系统</li><li>优化了移动端体验</li></ul>',
                date: '2023-05-10',
                likes: 98,
                comments: 15,
                fullContent: '<h1>新功能上线通知</h1><p>我们很高兴地宣布，论坛新增了以下功能：</p><ul><li>帖子编辑器支持多种格式</li><li>新增用户等级系统</li><li>优化了移动端体验</li></ul>',
                tags: ['公告', '新功能']
            },
            {
                id: 3,
                authorId: '10001',
                title: '产品需求征集',
                content: '<p>我们正在规划下一阶段的产品功能，欢迎提出您的建议和需求！</p><p>您的意见对我们非常重要。</p>',
                date: '2023-05-15',
                likes: 76,
                comments: 42,
                fullContent: '<h1>产品需求征集</h1><p>我们正在规划下一阶段的产品功能，欢迎提出您的建议和需求！</p><p>您的意见对我们非常重要。</p>',
                tags: ['征集', '产品']
            }
        ];

        let comments = [];
        let viewingPostId = null;
        let uploadedImages = []; // 存储上传的图片URL
        let currentTags = []; // 存储当前帖子的标签

        // DOM元素
        const registerBtn = document.getElementById('registerBtn');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const createPostBtn = document.getElementById('createPostBtn');
        let postList = document.getElementById('postList');
        const mainContentArea = document.getElementById('mainContentArea');

        // 模态框
        const registerModal = document.getElementById('registerModal');
        const loginModal = document.getElementById('loginModal');
        const postModal = document.getElementById('postModal');
        const profileModal = document.getElementById('profileModal');
        const editProfileModal = document.getElementById('editProfileModal');
        const changePasswordModal = document.getElementById('changePasswordModal');
        const adminModal = document.getElementById('adminModal');
        const messageModal = document.getElementById('messageModal');
        const messageText = document.getElementById('messageText');
        const messageOk = document.getElementById('messageOk');

        // 注册表单
        const registerForm = document.getElementById('registerForm');
        const registerUsername = document.getElementById('registerUsername');
        const registerPassword = document.getElementById('registerPassword');
        const confirmPassword = document.getElementById('confirmPassword');
        const closeRegisterModal = document.getElementById('closeRegisterModal');
        const cancelRegister = document.getElementById('cancelRegister');
        const submitRegister = document.getElementById('submitRegister');

        // 登录表单
        const loginForm = document.getElementById('loginForm');
        const loginUsername = document.getElementById('loginUsername');
        const loginPassword = document.getElementById('loginPassword');
        const loginAvatarImg = document.getElementById('loginAvatarImg');
        const rememberMe = document.getElementById('rememberMe');
        const goToRegister = document.getElementById('goToRegister');
        const closeLoginModal = document.getElementById('closeLoginModal');
        const submitLogin = document.getElementById('submitLogin');

        // 发布帖子表单
        const postForm = document.getElementById('postForm');
        const postTitle = document.getElementById('postTitle');
        const postContent = document.getElementById('postContent');
        const closePostModal = document.getElementById('closePostModal');
        const cancelPost = document.getElementById('cancelPost');
        const submitPost = document.getElementById('submitPost');
        const insertImageBtn = document.getElementById('insertImageBtn');
        const imageUpload = document.getElementById('imageUpload');

        // 标签相关元素
        const tagInput = document.getElementById('tagInput');
        const tagsContainer = document.getElementById('tagsContainer');

        // 个人主页相关元素
        const closeProfileModal = document.getElementById('closeProfileModal');
        const editProfileBtn = document.getElementById('editProfileBtn');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const adminBtn = document.getElementById('adminBtn');
        const avatarUpload = document.getElementById('avatarUpload');
        const profileAvatarImg = document.getElementById('profileAvatarImg');

        // 编辑资料相关元素
        const closeEditProfileModal = document.getElementById('closeEditProfileModal');
        const cancelEditProfile = document.getElementById('cancelEditProfile');
        const saveProfile = document.getElementById('saveProfile');
        const editBio = document.getElementById('editBio');

        // 修改密码相关元素
        const closeChangePasswordModal = document.getElementById('closeChangePasswordModal');
        const cancelChangePassword = document.getElementById('cancelChangePassword');
        const savePassword = document.getElementById('savePassword');
        const oldPassword = document.getElementById('oldPassword');
        const newPassword = document.getElementById('newPassword');
        const confirmNewPassword = document.getElementById('confirmNewPassword');

        // 用户管理相关元素
        const closeAdminModal = document.getElementById('closeAdminModal');
        const closeAdmin = document.getElementById('closeAdmin');

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 检查本地存储中是否有登录状态
            checkLoginStatus();

            renderPosts();

            // 事件监听器
            registerBtn.addEventListener('click', openRegisterModal);
            loginBtn.addEventListener('click', openLoginModal);
            logoutBtn.addEventListener('click', logout);
            createPostBtn.addEventListener('click', openPostModal);
            goToRegister.addEventListener('click', function(e) {
                e.preventDefault();
                closeLoginModalFunc();
                openRegisterModal();
            });

            // 消息弹窗确定按钮
            messageOk.addEventListener('click', function() {
                messageModal.style.display = 'none';
            });

            // 注册相关
            closeRegisterModal.addEventListener('click', closeRegisterModalFunc);
            cancelRegister.addEventListener('click', closeRegisterModalFunc);
            submitRegister.addEventListener('click', submitRegisterFunc);

            // 登录相关
            closeLoginModal.addEventListener('click', closeLoginModalFunc);
            submitLogin.addEventListener('click', submitLoginFunc);

            // 发布帖子相关
            closePostModal.addEventListener('click', closePostModalFunc);
            cancelPost.addEventListener('click', closePostModalFunc);
            submitPost.addEventListener('click', submitPostFunc);
            insertImageBtn.addEventListener('click', () => imageUpload.click());
            imageUpload.addEventListener('change', uploadImageToEditor);

            // 标签相关事件
            tagInput.addEventListener('keydown', handleTagInput);

            // 个人主页相关
            closeProfileModal.addEventListener('click', closeProfileModalFunc);
            editProfileBtn.addEventListener('click', openEditProfileModal);
            changePasswordBtn.addEventListener('click', openChangePasswordModal);
            adminBtn.addEventListener('click', openAdminModal);

            // 修复头像上传功能
            document.getElementById('profileAvatarContainer').addEventListener('click', function() {
                document.getElementById('avatarUpload').click();
            });
            avatarUpload.addEventListener('change', handleAvatarUpload);

            // 编辑资料相关
            closeEditProfileModal.addEventListener('click', closeEditProfileModalFunc);
            cancelEditProfile.addEventListener('click', closeEditProfileModalFunc);
            saveProfile.addEventListener('click', saveProfileFunc);

            // 修改密码相关
            closeChangePasswordModal.addEventListener('click', closeChangePasswordModalFunc);
            cancelChangePassword.addEventListener('click', closeChangePasswordModalFunc);
            savePassword.addEventListener('click', savePasswordFunc);

            // 用户管理相关
            closeAdminModal.addEventListener('click', closeAdminModalFunc);
            closeAdmin.addEventListener('click', closeAdminModalFunc);
        });

        // 显示消息弹窗
        function showMessage(message) {
            messageText.textContent = message;
            messageModal.style.display = 'flex';
        }

        // 退出登录
        function logout() {
            currentUser = null;
            clearLoginStatus();
            updateUIAfterLogout();
            showMessage('您已成功退出登录');
        }

        // 检查登录状态
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('currentUser');
            const remember = localStorage.getItem('rememberMe') === 'true';

            if (savedUser && remember) {
                try {
                    const user = JSON.parse(savedUser);
                    const foundUser = users.find(u => u.id === user.id && u.password === user.password);
                    if (foundUser) {
                        currentUser = foundUser;
                        updateUIAfterLogin();

                        // 更新记住我复选框状态
                        rememberMe.checked = true;
                        showMessage(`欢迎回来，${currentUser.username}！`);
                    }
                } catch (e) {
                    console.error('解析用户数据失败:', e);
                }
            }
        }

        // 更新登录后的UI
        function updateUIAfterLogin() {
            registerBtn.style.display = 'none';
            loginBtn.style.display = 'none';
            logoutBtn.style.display = 'block';
            createPostBtn.style.display = 'block';

            // 显示当前用户名
            const authButtons = document.querySelector('.auth-buttons');
            let userInfo = authButtons.querySelector('.user-info');

            if (!userInfo) {
                userInfo = document.createElement('div');
                userInfo.className = 'user-info';
                userInfo.style.color = 'white';
                userInfo.style.marginRight = '10px';
                userInfo.style.cursor = 'pointer';
                userInfo.textContent = currentUser.username;
                userInfo.addEventListener('click', function() {
                    viewProfile(currentUser.id);
                });
                authButtons.insertBefore(userInfo, authButtons.firstChild);
            } else {
                userInfo.textContent = currentUser.username;
            }
        }

        // 更新退出后的UI
        function updateUIAfterLogout() {
            registerBtn.style.display = 'block';
            loginBtn.style.display = 'block';
            logoutBtn.style.display = 'none';
            createPostBtn.style.display = 'none';

            // 移除用户信息显示
            const authButtons = document.querySelector('.auth-buttons');
            const userInfo = authButtons.querySelector('.user-info');
            if (userInfo) {
                authButtons.removeChild(userInfo);
            }

            // 刷新页面内容
            if (viewingPostId) {
                backToPostList();
            } else {
                renderPosts();
            }
        }

        // 保存登录状态到本地存储
        function saveLoginStatus() {
            if (currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                if (rememberMe.checked) {
                    localStorage.setItem('rememberMe', 'true');
                } else {
                    localStorage.removeItem('rememberMe');
                }
            }
        }

        // 清除登录状态
        function clearLoginStatus() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('rememberMe');
        }

        // 渲染帖子列表
        function renderPosts() {
            postList.innerHTML = '';

            posts.forEach(post => {
                const author = users.find(u => u.id === post.authorId);
                const postElement = document.createElement('div');
                postElement.className = 'post-item';

                // 生成标签HTML
                let tagsHtml = '';
                if (post.tags && post.tags.length > 0) {
                    tagsHtml = '<div class="tags-container">';
                    post.tags.forEach(tag => {
                        tagsHtml += `<span class="tag">#${tag}</span>`;
                    });
                    tagsHtml += '</div>';
                }

                postElement.innerHTML = `
                    <div class="post-author">
                        <div class="post-author-avatar" onclick="viewProfile('${author.id}')">
                            <img src="${author.avatar || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(author.username) + '&background=1e88e5&color=fff'}" alt="用户头像">
                        </div>
                        <div class="post-author-info">
                            <span class="post-author-name" onclick="viewProfile('${author.id}')">${author.username}</span>
                            ${author.isV ? '<span class="post-author-v">V</span>' : ''}
                            <div class="post-author-level">Lv.${author.level}</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <a href="#" class="post-title-link" onclick="viewPost(${post.id}); return false;">${post.title || '无标题'}</a>
                        ${tagsHtml}
                        <div class="post-excerpt">${post.content}</div>
                    </div>
                    <div class="post-meta">
                        <div class="post-meta-item">
                            <i>👍</i> ${post.likes}
                        </div>
                        <div class="post-meta-item">
                            <i>💬</i> ${post.comments}
                        </div>
                        <div class="post-meta-item">
                            <i>📅</i> ${post.date}
                        </div>
                        ${(currentUser && (currentUser.id === post.authorId || currentUser.id === '001' || currentUser.id === '10000')) ? `
                        <div class="post-meta-item" style="color: #f44336; cursor: pointer;" onclick="deletePost(${post.id})">
                            删除
                        </div>
                        ` : ''}
                    </div>
                `;
                postList.appendChild(postElement);
            });
        }

        // 查看帖子详情
        function viewPost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;

            const author = users.find(u => u.id === post.authorId);

            // 生成标签HTML
            let tagsHtml = '';
            if (post.tags && post.tags.length > 0) {
                tagsHtml = '<div class="tags-container">';
                post.tags.forEach(tag => {
                    tagsHtml += `<span class="tag">#${tag}</span>`;
                });
                tagsHtml += '</div>';
            }

            mainContentArea.innerHTML = `
                <div class="post-detail">
                    <div class="post-author">
                        <div class="post-author-avatar" onclick="viewProfile('${author.id}')">
                            <img src="${author.avatar || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(author.username) + '&background=1e88e5&color=fff'}" alt="用户头像">
                        </div>
                        <div class="post-author-info">
                            <span class="post-author-name" onclick="viewProfile('${author.id}')">${author.username}</span>
                            ${author.isV ? '<span class="post-author-v">V</span>' : ''}
                            <div class="post-author-level">Lv.${author.level}</div>
                        </div>
                    </div>
                    <h1 class="post-detail-title">${post.title || '无标题'}</h1>
                    ${tagsHtml}
                    <div class="post-detail-content">
                        ${post.fullContent || post.content}
                    </div>
                    <div class="post-meta">
                        <div class="post-meta-item">
                            <i>👍</i> ${post.likes}
                        </div>
                        <div class="post-meta-item">
                            <i>💬</i> ${post.comments}
                        </div>
                        <div class="post-meta-item">
                            <i>📅</i> ${post.date}
                        </div>
                        ${(currentUser && (currentUser.id === author.id || currentUser.id === '001' || currentUser.id === '10000')) ? `
                        <div class="post-meta-item" style="color: #f44336; cursor: pointer;" onclick="deletePost(${post.id})">
                            删除
                        </div>
                        ` : ''}
                    </div>
                    <a href="#" class="back-to-list" onclick="backToPostList(); return false;">← 返回帖子列表</a>
                </div>
            `;

            viewingPostId = postId;
        }

        // 返回帖子列表
        function backToPostList() {
            mainContentArea.innerHTML = `
                <div class="post-header">
                    <h1 class="post-title">最新帖子</h1>
                    ${currentUser ? '<button class="create-post-btn" id="createPostBtn">发布帖子</button>' : ''}
                </div>
                <div class="post-list" id="postList"></div>
            `;

            // 重新绑定事件
            if (currentUser) {
                document.getElementById('createPostBtn').addEventListener('click', openPostModal);
            }
            postList = document.getElementById('postList');

            renderPosts();
            viewingPostId = null;
        }

        // 删除帖子
        function deletePost(postId) {
            if (confirm('确定要删除这篇帖子吗？')) {
                posts = posts.filter(p => p.id !== postId);
                renderPosts();
                showMessage('帖子已删除');

                // 如果正在查看被删除的帖子，返回帖子列表
                if (viewingPostId === postId) {
                    backToPostList();
                }
            }
        }

        // 打开注册模态框
        function openRegisterModal() {
            registerModal.style.display = 'flex';
            registerUsername.value = '';
            registerPassword.value = '';
            confirmPassword.value = '';
        }

        // 关闭注册模态框
        function closeRegisterModalFunc() {
            registerModal.style.display = 'none';
        }

        // 提交注册
        function submitRegisterFunc() {
            const username = registerUsername.value.trim();
            const password = registerPassword.value.trim();
            const confirm = confirmPassword.value.trim();

            if (username.length < 6) {
                showMessage('账号不得少于6位');
                return;
            }

            if (password.length < 8) {
                showMessage('密码不得少于8位');
                return;
            }

            if (password !== confirm) {
                showMessage('两次输入的密码不一致');
                return;
            }

            // 检查用户是否已存在
            const userExists = users.some(u => u.id === username);
            if (userExists) {
                showMessage('该账号已被注册');
                return;
            }

            // 注册新用户
            const newUser = {
                id: username,
                username: `用户${username}`,
                password: password,
                level: 1,
                isV: false,
                followers: 0,
                joinDate: new Date().toISOString().split('T')[0],
                bio: '',
                avatar: `https://ui-avatars.com/api/?name=用户${username}&background=1e88e5&color=fff`
            };

            users.push(newUser);
            showMessage('注册成功！');
            closeRegisterModalFunc();
        }

        // 打开登录模态框
        function openLoginModal() {
            loginModal.style.display = 'flex';
            loginUsername.value = '';
            loginPassword.value = '';

            // 如果有记住的用户名，自动填充
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser && localStorage.getItem('rememberMe') === 'true') {
                try {
                    const user = JSON.parse(savedUser);
                    loginUsername.value = user.id;
                    loginPassword.focus();
                } catch (e) {
                    console.error('解析用户数据失败:', e);
                }
            } else {
                loginUsername.focus();
            }
        }

        // 关闭登录模态框
        function closeLoginModalFunc() {
            loginModal.style.display = 'none';
        }

        // 提交登录
        function submitLoginFunc() {
            const username = loginUsername.value.trim();
            const password = loginPassword.value.trim();

            if (!username) {
                showMessage('请输入账号');
                return;
            }

            if (!password) {
                showMessage('请输入密码');
                return;
            }

            const user = users.find(u => u.id === username && u.password === password);

            if (!user) {
                showMessage('账号或密码错误');
                return;
            }

            currentUser = user;

            // 更新登录头像显示
            loginAvatarImg.src = user.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.username)}&background=1e88e5&color=fff`;

            showMessage(`欢迎回来，${user.username}！`);
            closeLoginModalFunc();

            // 更新UI
            updateUIAfterLogin();

            // 保存登录状态
            saveLoginStatus();
        }

        // 打开发布帖子模态框
        function openPostModal() {
            if (!currentUser) {
                showMessage('请先登录');
                openLoginModal();
                return;
            }

            postModal.style.display = 'flex';
            postTitle.value = '';
            postContent.innerHTML = '';
            currentTags = []; // 重置标签
            tagsContainer.innerHTML = ''; // 清空标签容器
            setTimeout(() => postContent.focus(), 0);
        }

        // 关闭发布帖子模态框
        function closePostModalFunc() {
            postModal.style.display = 'none';
        }

        // 上传图片到编辑器
        function uploadImageToEditor() {
            const file = imageUpload.files[0];
            if (!file) return;

            if (!file.type.match('image.*')) {
                showMessage('请选择图片文件');
                return;
            }

            // 使用URL.createObjectURL创建临时URL
            const imageUrl = URL.createObjectURL(file);

            // 插入图片到编辑器
            const img = document.createElement('img');
            img.src = imageUrl;
            img.style.maxWidth = '100%';
            img.style.height = 'auto';
            img.style.borderRadius = '8px';

            const range = window.getSelection().getRangeAt(0);
            range.insertNode(img);

            // 在图片后添加换行
            const br = document.createElement('br');
            range.insertNode(br);

            // 将光标移动到新位置
            range.setStartAfter(br);
            range.setEndAfter(br);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);

            postContent.focus();

            // 保存图片URL以便后续使用
            uploadedImages.push(imageUrl);

            // 重置文件输入，以便可以再次选择同一文件
            imageUpload.value = '';
        }

        // 处理标签输入
        function handleTagInput(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const tagValue = tagInput.value.trim();

                if (tagValue && currentTags.length < 5) {
                    // 移除可能包含的#号
                    const cleanTag = tagValue.replace(/^#+/, '');

                    if (cleanTag && !currentTags.includes(cleanTag)) {
                        currentTags.push(cleanTag);
                        renderTags();
                        tagInput.value = '';
                    }
                }
            }
        }

        // 渲染标签
        function renderTags() {
            tagsContainer.innerHTML = '';
            currentTags.forEach((tag, index) => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.innerHTML = `
                    <span>#${tag}</span>
                    <span class="tag-remove" onclick="removeTag(${index})">×</span>
                `;
                tagsContainer.appendChild(tagElement);
            });
        }

        // 移除标签
        function removeTag(index) {
            currentTags.splice(index, 1);
            renderTags();
        }

        // 提交帖子
        function submitPostFunc() {
            const title = postTitle.value.trim();
            const content = postContent.innerHTML;

            if (!title) {
                showMessage('请输入帖子标题');
                return;
            }

            if (!content) {
                showMessage('请输入帖子内容');
                return;
            }

            // 创建新帖子
            const newPost = {
                id: posts.length > 0 ? Math.max(...posts.map(p => p.id)) + 1 : 1,
                authorId: currentUser.id,
                title: title,
                content: content,
                fullContent: content,
                date: new Date().toLocaleDateString(),
                likes: 0,
                comments: 0,
                tags: [...currentTags] // 保存标签
            };

            posts.unshift(newPost);

            // 用户等级提升
            const user = users.find(u => u.id === currentUser.id);
            if (user && user.level < 100) {
                user.level += 1;
            }

            showMessage('帖子发布成功！');
            closePostModalFunc();

            // 刷新帖子列表
            if (viewingPostId) {
                backToPostList();
            } else {
                renderPosts();
            }
        }

        // 查看用户个人主页
        function viewProfile(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;

            // 更新个人主页内容
            document.getElementById('profileName').textContent = user.username;
            document.getElementById('profileV').style.display = user.isV ? 'inline-block' : 'none';
            document.getElementById('profileOfficial').style.display = user.isV ? 'block' : 'none';
            document.getElementById('profileLevel').textContent = `等级: Lv.${user.level}`;
            document.getElementById('profileAccount').textContent = `账号: ${user.id}`;
            document.getElementById('profileJoinDate').textContent = `注册时间: ${user.joinDate}`;
            document.getElementById('profileBio').textContent = user.bio || '这个人很懒，什么都没有留下...';

            // 计算用户帖子数量
            const userPosts = posts.filter(p => p.authorId === user.id);
            document.getElementById('postCount').textContent = userPosts.length;
            document.getElementById('followerCount').textContent = user.followers;

            // 设置头像
            const profileAvatarImg = document.getElementById('profileAvatarImg');
            profileAvatarImg.src = user.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.username)}&background=1e88e5&color=fff`;

            // 显示管理员按钮（如果是管理员用户）
            document.getElementById('adminBtn').style.display = (user.id === '001') ? 'block' : 'none';

            // 渲染用户的帖子
            renderUserPosts(user.id);

            // 打开个人主页模态框
            profileModal.style.display = 'flex';
        }

        // 渲染用户帖子
        function renderUserPosts(userId) {
            const userPostList = document.getElementById('userPostList');
            userPostList.innerHTML = '';

            const userPosts = posts.filter(p => p.authorId === userId);

            if (userPosts.length === 0) {
                userPostList.innerHTML = '<div class="no-posts">该用户还没有发布任何帖子</div>';
                return;
            }

            userPosts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post-item';

                // 生成标签HTML
                let tagsHtml = '';
                if (post.tags && post.tags.length > 0) {
                    tagsHtml = '<div class="tags-container">';
                    post.tags.forEach(tag => {
                        tagsHtml += `<span class="tag">#${tag}</span>`;
                    });
                    tagsHtml += '</div>';
                }

                postElement.innerHTML = `
                    <div class="post-content">
                        <a href="#" class="post-title-link" onclick="viewPost(${post.id}); return false;">${post.title || '无标题'}</a>
                        ${tagsHtml}
                        <div class="post-excerpt">${post.content}</div>
                    </div>
                    <div class="post-meta">
                        <div class="post-meta-item">
                            <i>👍</i> ${post.likes}
                        </div>
                        <div class="post-meta-item">
                            <i>💬</i> ${post.comments}
                        </div>
                        <div class="post-meta-item">
                            <i>📅</i> ${post.date}
                        </div>
                        ${(currentUser && (currentUser.id === post.authorId || currentUser.id === '001' || currentUser.id === '10000')) ? `
                        <div class="post-meta-item" style="color: #f44336; cursor: pointer;" onclick="deletePost(${post.id})">
                            删除
                        </div>
                        ` : ''}
                    </div>
                `;
                userPostList.appendChild(postElement);
            });
        }

        // 关闭个人主页模态框
        function closeProfileModalFunc() {
            profileModal.style.display = 'none';
        }

        // 打开编辑资料模态框
        function openEditProfileModal() {
            const user = users.find(u => u.id === currentUser.id);
            if (user) {
                editBio.value = user.bio || '';
                editProfileModal.style.display = 'flex';
            }
        }

        // 关闭编辑资料模态框
        function closeEditProfileModalFunc() {
            editProfileModal.style.display = 'none';
        }

        // 保存个人资料
        function saveProfileFunc() {
            const user = users.find(u => u.id === currentUser.id);
            if (user) {
                user.bio = editBio.value;
                document.getElementById('profileBio').textContent = user.bio || '这个人很懒，什么都没有留下...';
                showMessage('个人资料已更新');
                closeEditProfileModalFunc();
            }
        }

        // 打开修改密码模态框
        function openChangePasswordModal() {
            changePasswordModal.style.display = 'flex';
            oldPassword.value = '';
            newPassword.value = '';
            confirmNewPassword.value = '';
        }

        // 关闭修改密码模态框
        function closeChangePasswordModalFunc() {
            changePasswordModal.style.display = 'none';
        }

        // 保存密码
        function savePasswordFunc() {
            if (newPassword.value !== confirmNewPassword.value) {
                showMessage('两次输入的新密码不一致');
                return;
            }

            if (newPassword.value.length < 8) {
                showMessage('新密码长度不能少于8位');
                return;
            }

            const user = users.find(u => u.id === currentUser.id);
            if (user) {
                if (user.password !== oldPassword.value) {
                    showMessage('旧密码不正确');
                    return;
                }

                user.password = newPassword.value;
                showMessage('密码修改成功');
                closeChangePasswordModalFunc();
            }
        }

        // 打开用户管理模态框
        function openAdminModal() {
            adminModal.style.display = 'flex';
        }

        // 关闭用户管理模态框
        function closeAdminModalFunc() {
            adminModal.style.display = 'none';
        }

        // 处理头像上传
        function handleAvatarUpload() {
            const file = avatarUpload.files[0];
            if (!file) return;

            if (!file.type.match('image.*')) {
                showMessage('请选择图片文件');
                return;
            }

            // 使用URL.createObjectURL创建临时URL
            const imageUrl = URL.createObjectURL(file);

            // 更新头像
            profileAvatarImg.src = imageUrl;

            // 更新用户头像
            const user = users.find(u => u.id === currentUser.id);
            if (user) {
                user.avatar = imageUrl;
            }

            // 更新登录头像
            loginAvatarImg.src = imageUrl;

            showMessage('头像更新成功');
        }
    </script>
</body>
</html>
